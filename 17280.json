{"post_stream":{"posts":[{"id":69072,"name":"Merlijn Sebrechts","username":"galgalesh","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png","created_at":"2020-05-07T21:05:42.830Z","cooked":"\u003cp\u003eOne way to improve the user experience of your snaps is by reducing their size. Not only does this reduce the amount of \u003cstrong\u003estorage and network bandwidth\u003c/strong\u003e required to install and update your snap, but it also reduces its \u003cstrong\u003estartup time\u003c/strong\u003e. Since snaps are stored compressed on disk, they need to be decompressed when your application starts, and that takes longer when your snap is larger.\u003c/p\u003e\n\u003ch2\u003eUsing content snaps and extensions\u003c/h2\u003e\n\u003cp\u003eSnaps can provide content to other snaps using the \u003ca href=\"https://forum.snapcraft.io/t/the-content-interface/1074\"\u003econtent interface\u003c/a\u003e. Many popular runtimes and libraries such as GNOME, Qt and Wine are packaged in content snaps. Instead of adding those libraries to your snap, you can connect to the relevant content snaps. The easiest way to use content snaps is to use one of the \u003ca href=\"/t/snapcraft-extensions/13486\"\u003eSnapcraft desktop extensions\u003c/a\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSnaps using KDE Frameworks or Qt5 can use the \u003ca href=\"/t/the-kde-neon-extension/13752\"\u003e\u003ccode\u003ekde-neon\u003c/code\u003e extension\u003c/a\u003e which adds content snaps for themes, the Qt5 runtime and KDE frameworks.\u003c/li\u003e\n\u003cli\u003eMost other desktop snaps can use the \u003ca href=\"/t/the-gnome-3-28-extension/13485\"\u003e\u003ccode\u003egnome-3-28\u003c/code\u003e extension\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003eSnaps using Wine can use the \u003ca href=\"https://snapcraft.io/wine-platform-runtime\" rel=\"noopener nofollow ugc\"\u003e\u003ccode\u003ewine-platform-runtime\u003c/code\u003e\u003c/a\u003e and \u003ca href=\"https://snapcraft.io/wine-platform-5-stable\" rel=\"noopener nofollow ugc\"\u003e\u003ccode\u003ewine-platform-5-stable\u003c/code\u003e\u003c/a\u003e snaps.\u003c/li\u003e\n\u003cli\u003eThe \u003ca href=\"/t/how-to-use-the-system-gtk-theme-via-the-gtk-common-themes-snap/6235\"\u003e\u003ccode\u003egtk-common-themes\u003c/code\u003e\u003c/a\u003e bundles many popular GTK, cursor and icon themes.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://forum.snapcraft.io/images/emoji/emoji_one/warning.png?v=9\" title=\":warning:\" class=\"emoji\" alt=\":warning:\"\u003e Updating an existing snap to use a content snap or extension will not automatically reduce the size of your snap. You also need to manually remove the relevant libraries from your snap by removing them from \u003ccode\u003estage-packages\u003c/code\u003e, for example. The \u003ca\u003ecleanup part\u003c/a\u003e can help you do this automatically.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003eAvoid staging development files\u003c/h2\u003e\n\u003cp\u003eThe Ubuntu archives include many packages with development files whose name ends in \u003ccode\u003e-dev\u003c/code\u003e. These packages are required to compile software which uses the libraries. For example, in order to compile software which uses \u003ccode\u003elibgtk-3-0\u003c/code\u003e (10.1 MB), you also need to install \u003ccode\u003elibgtk-3-dev\u003c/code\u003e (+14.0 MB). After compilation, these packages are not needed anymore, so it’s important to make sure they are not included in your snap. In the example of \u003ccode\u003elibgtk-3-0\u003c/code\u003e, this will more than halve the size of the library in your snap.\u003c/p\u003e\n\u003cp\u003eTo avoid this, move all \u003ccode\u003estage-packages\u003c/code\u003e which end in \u003ccode\u003e-dev\u003c/code\u003e to \u003ccode\u003ebuild-packages\u003c/code\u003e and add their regular counterpart to \u003ccode\u003estage-packages\u003c/code\u003e. See \u003ca href=\"https://snapcraft.io/docs/build-and-staging-dependencies\" rel=\"noopener nofollow ugc\"\u003eBuild and staging dependencies\u003c/a\u003e for more information.\u003c/p\u003e\n\u003ch2 id=\"heading--cleanup-part\"\u003eUsing the cleanup part\u003csup\u003e\u003ca href=\"#heading--cleanup-part\"\u003e⚓\u003c/a\u003e\u003c/sup\u003e\n\u003c/h2\u003e\n\u003cp\u003eSnaps often ship libraries that are already available in the base snap or connected content snaps. This is because \u003ccode\u003estage-packages\u003c/code\u003e currently pulls in all the dependencies of the packages you list, even if those dependencies are already available from content snaps.\u003c/p\u003e\n\u003cp\u003eYou can remove those libraries manually by excluding them using the \u003ca\u003e\u003ccode\u003estage\u003c/code\u003e\u003c/a\u003e or \u003ca\u003e\u003ccode\u003eprime\u003c/code\u003e\u003c/a\u003e keywords. This requires a lot of manual work, however, because you have to figure out which libraries are duplicated and exclude each one manually. An easier method is to use the following \u003ccode\u003ecleanup\u003c/code\u003e part, which automatically compares your snap with all the content snaps you specify and removes duplicate files.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eAdd the following part to your \u003ccode\u003esnapcraft.yaml\u003c/code\u003e in the \u003ccode\u003eparts\u003c/code\u003e section.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e# This part removes all the files in this snap which already exist in\n# connected content and base snaps. Since these files will be available\n# at runtime from the content and base snaps, they do not need to be\n# included in this snap itself.\n#\n# More info: https://forum.snapcraft.io/t/reducing-the-size-of-desktop-snaps/17280#heading--cleanup-part\n#\ncleanup:\n  after:  # Make this part run last; list all your other parts here\n    - \u0026lt;YOUR-PARTS\u0026gt;\n  plugin: nil\n  build-snaps:  # List all content-snaps and base snaps you're using here\n    - \u0026lt;CORE-SNAP\u0026gt;\n    - \u0026lt;CONTENT-SNAP-1\u0026gt;\n    - \u0026lt;CONTENT-SNAP-2\u0026gt;\n  override-prime: |\n    set -eux\n    for snap in \"\u0026lt;CORE-SNAP\u0026gt;\" \"\u0026lt;CONTENT-SNAP-1\u0026gt;\" \"\u0026lt;CONTENT-SNAP-2\u0026gt;\"; do  # List all content-snaps and base snaps you're using here\n        cd \"/snap/$snap/current\" \u0026amp;\u0026amp; find . -type f,l -exec rm -f \"$SNAPCRAFT_PRIME/{}\" \\;\n    done\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eList all the other parts of your snap in the \u003ccode\u003eafter\u003c/code\u003e section, so that this part gets built last.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eReplace \u003ccode\u003e\u0026lt;CORE-SNAP\u0026gt;\u003c/code\u003e in the \u003ccode\u003ebuild-snaps\u003c/code\u003e and \u003ccode\u003eoverride-prime\u003c/code\u003e sections with the \u003ccode\u003ebase\u003c/code\u003e that you’re using.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eList all your content snaps that you use in the \u003ccode\u003ebuild-snaps\u003c/code\u003e and \u003ccode\u003eoverride-prime\u003c/code\u003e sections.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://forum.snapcraft.io/images/emoji/emoji_one/information_source.png?v=9\" title=\":information_source:\" class=\"emoji\" alt=\":information_source:\"\u003e If your snap uses extensions, you can use the \u003ccode\u003esnapcraft expand-extensions\u003c/code\u003e command to see which content snaps the extension will add.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003eⓘ See \u003ca href=\"/t/desktop-applications/13034\"\u003eDesktop applications\u003c/a\u003e for more information on how to snap a desktop application.\u003c/p\u003e\n\u003c/blockquote\u003e","post_number":1,"post_type":1,"updated_at":"2020-07-29T12:19:24.561Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":517,"reads":66,"readers_count":65,"score":2728.2,"yours":false,"topic_id":17280,"topic_slug":"reducing-the-size-of-desktop-snaps","display_username":"Merlijn Sebrechts","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":3,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/the-content-interface/1074","internal":true,"reflection":false,"title":"The content interface","clicks":8},{"url":"https://forum.snapcraft.io/t/snapcraft-extensions/13486","internal":true,"reflection":false,"title":"Snapcraft Extensions","clicks":7},{"url":"https://forum.snapcraft.io/t/the-kde-neon-extension/13752","internal":true,"reflection":false,"title":"The kde-neon extension","clicks":3},{"url":"https://forum.snapcraft.io/t/the-gnome-3-28-extension/13485","internal":true,"reflection":false,"title":"The gnome-3-28 extension","clicks":3},{"url":"https://snapcraft.io/docs/build-and-staging-dependencies","internal":false,"reflection":false,"title":"Build and staging dependencies | Snapcraft documentation","clicks":2},{"url":"https://forum.snapcraft.io/t/how-to-use-the-system-gtk-theme-via-the-gtk-common-themes-snap/6235","internal":true,"reflection":false,"title":"How to use the system GTK theme via the gtk-common-themes snap","clicks":1},{"url":"https://snapcraft.io/wine-platform-runtime","internal":false,"reflection":false,"title":"Install wine-platform-runtime for Linux using the Snap Store | Snapcraft","clicks":1},{"url":"https://snapcraft.io/wine-platform-5-stable","internal":false,"reflection":false,"title":"Install wine-platform-5-stable for Linux using the Snap Store | Snapcraft","clicks":0},{"url":"https://forum.snapcraft.io/t/desktop-applications/13034","internal":true,"reflection":true,"title":"Desktop applications","clicks":8},{"url":"https://forum.snapcraft.io/t/linux-mint-20-disables-deb2snap-packages-and-snaps-growing-external-adoption-problem/17913/144","internal":true,"reflection":true,"title":"Linux Mint 20 disables deb2snap packages, and Snap's growing external adoption problem","clicks":1},{"url":"https://forum.snapcraft.io/t/application-startup-performance/17273/6","internal":true,"reflection":true,"title":"Application startup performance","clicks":0},{"url":"https://forum.snapcraft.io/t/snapcraft-crashes-when-uploading-snap-file/24499/3","internal":true,"reflection":true,"title":"Snapcraft crashes when uploading snap file","clicks":0},{"url":"https://forum.snapcraft.io/t/snap-documentation/11127","internal":true,"reflection":true,"title":"Snap documentation","clicks":0},{"url":"https://forum.snapcraft.io/t/after-cleanup-part-command-not-found-in-the-prime-directory-but-its-there/18633/3","internal":true,"reflection":true,"title":"After cleanup part, command not found in the prime directory, but it's there","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":7}],"moderator":false,"admin":false,"staff":false,"user_id":1418,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":true,"last_wiki_edit":"2020-07-29T12:19:24.582Z","can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":69178,"name":"Neil McPhail","username":"mcphail","avatar_template":"/letter_avatar/mcphail/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png","created_at":"2020-05-08T22:53:02.505Z","cooked":"\u003cp\u003eGosh. Using your \u003ccode\u003ecleanup\u003c/code\u003e part takes my \u003ccode\u003equake-shareware\u003c/code\u003e snap from 65MB down to 1MB. This is brilliant. Thanks!\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2020-05-08T22:53:02.505Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":3,"reads":40,"readers_count":39,"score":68.0,"yours":false,"topic_id":17280,"topic_slug":"reducing-the-size-of-desktop-snaps","display_username":"Neil McPhail","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":3}],"moderator":false,"admin":false,"staff":false,"user_id":1600,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[69072,69178]},"timeline_lookup":[[1,1134],[2,1133]],"suggested_topics":[{"id":30809,"title":"The ROS 2 Humble extension","fancy_title":"The ROS 2 Humble extension","slug":"the-ros-2-humble-extension","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-08T20:12:10.035Z","last_posted_at":"2022-07-08T20:12:10.192Z","bumped":true,"bumped_at":"2023-03-13T13:44:02.640Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1244,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":6739,"username":"artivis","name":"Jeremie Deray","avatar_template":"/user_avatar/forum.snapcraft.io/artivis/{size}/5695_2.png"}}]},{"id":35563,"title":"The WebkitGTK Problem","fancy_title":"The WebkitGTK Problem","slug":"the-webkitgtk-problem","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2023-06-10T19:28:37.898Z","last_posted_at":"2023-06-10T19:28:38.095Z","bumped":true,"bumped_at":"2023-06-13T06:29:04.736Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":1,"views":55,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":13970,"username":"soumyaDghosh","name":"Soumyadeep Ghosh","avatar_template":"/letter_avatar/soumyadghosh/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}}]},{"id":30851,"title":"Snap How-to guides","fancy_title":"Snap How-to guides","slug":"snap-how-to-guides","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-12T10:45:54.942Z","last_posted_at":"2022-07-12T10:45:55.061Z","bumped":true,"bumped_at":"2022-07-12T10:45:55.061Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1546,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":34629,"title":"Release notes: Snapcraft 7.3","fancy_title":"Release notes: Snapcraft 7.3","slug":"release-notes-snapcraft-7-3","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2023-04-05T17:27:18.665Z","last_posted_at":"2023-04-05T17:27:18.809Z","bumped":true,"bumped_at":"2023-04-05T17:27:18.809Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":235,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":30605,"title":"Build and Publish a ROS Snap with GitHub Actions","fancy_title":"Build and Publish a ROS Snap with GitHub Actions","slug":"build-and-publish-a-ros-snap-with-github-actions","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2022-06-22T15:28:55.512Z","last_posted_at":"2022-06-22T15:43:40.132Z","bumped":true,"bumped_at":"2022-06-22T15:43:40.132Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":2,"views":1300,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":11989,"username":"gbeuzeboc","name":"","avatar_template":"/letter_avatar/gbeuzeboc/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}}]}],"tags":[],"id":17280,"title":"Reducing the size of desktop snaps","fancy_title":"Reducing the size of desktop snaps","posts_count":2,"created_at":"2020-05-07T21:05:42.685Z","views":3858,"reply_count":0,"like_count":10,"last_posted_at":"2020-05-08T22:53:02.505Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"reducing-the-size-of-desktop-snaps","category_id":15,"word_count":823,"deleted_at":null,"user_id":1418,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_17280","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":2,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"details":{"notification_level":1,"participants":[{"id":1418,"username":"galgalesh","name":"Merlijn Sebrechts","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":1600,"username":"mcphail","name":"Neil McPhail","avatar_template":"/letter_avatar/mcphail/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null}],"created_by":{"id":1418,"username":"galgalesh","name":"Merlijn Sebrechts","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png"},"last_poster":{"id":1600,"username":"mcphail","name":"Neil McPhail","avatar_template":"/letter_avatar/mcphail/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"},"links":[{"url":"https://forum.snapcraft.io/t/desktop-applications/13034","title":"Desktop applications","internal":true,"attachment":false,"reflection":true,"clicks":8,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/the-content-interface/1074","title":"The content interface","internal":true,"attachment":false,"reflection":false,"clicks":8,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/snapcraft-extensions/13486","title":"Snapcraft Extensions","internal":true,"attachment":false,"reflection":false,"clicks":7,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/the-gnome-3-28-extension/13485","title":"The gnome-3-28 extension","internal":true,"attachment":false,"reflection":false,"clicks":3,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/the-kde-neon-extension/13752","title":"The kde-neon extension","internal":true,"attachment":false,"reflection":false,"clicks":3,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://snapcraft.io/docs/build-and-staging-dependencies","title":"Build and staging dependencies | Snapcraft documentation","internal":false,"attachment":false,"reflection":false,"clicks":2,"user_id":1418,"domain":"snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/linux-mint-20-disables-deb2snap-packages-and-snaps-growing-external-adoption-problem/17913/144","title":"Linux Mint 20 disables deb2snap packages, and Snap's growing external adoption problem","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/how-to-use-the-system-gtk-theme-via-the-gtk-common-themes-snap/6235","title":"How to use the system GTK theme via the gtk-common-themes snap","internal":true,"attachment":false,"reflection":false,"clicks":1,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://snapcraft.io/wine-platform-runtime","title":"Install wine-platform-runtime for Linux using the Snap Store | Snapcraft","internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":1418,"domain":"snapcraft.io","root_domain":"snapcraft.io"}]}}