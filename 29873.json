{"post_stream":{"posts":[{"id":109032,"name":"Till Kamppeter","username":"till.kamppeter","avatar_template":"/user_avatar/forum.snapcraft.io/till.kamppeter/{size}/3687_2.png","created_at":"2022-05-06T09:31:13.329Z","cooked":"\u003cp\u003e\u003cstrong\u003eIntroduction\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003ecups\u003c/code\u003e interface should be plugged by all Snaps of software which prints, like LibreOffice, Chrome/Chromium, Firefox, Thunderbird, DarkTable, RawTherapee, … It allows them to print via CUPS but it blocks any administrative CUPS operations (like creating or modifying print queues or accessing other user’s jobs).\u003c/p\u003e\n\u003cp\u003eBefore the \u003ccode\u003ecups\u003c/code\u003e interface was introduced, you had to plug the \u003ccode\u003ecups-control\u003c/code\u003e interface for this, but as this interface does not only allow to list the available printers and their options and send print jobs but also create and modify queues and their permissions, read and delete anyone’s print jobs, … you either had to require the user to manually connect the interface or get explicit permission from the Snap Store team to auto-connect the interface.\u003c/p\u003e\n\u003cp\u003eAs we at \u003ca href=\"http://www.openprinting.org/\" rel=\"noopener nofollow ugc\"\u003eOpenPrinting\u003c/a\u003e want that printing “just works” for your users, this is a bad situation.\u003c/p\u003e\n\u003cp\u003eTherefore we have created the \u003ccode\u003ecups\u003c/code\u003e interface which allows the Snap which plugs it \u003cstrong\u003eonly\u003c/strong\u003e to list printers and the printer’s options, and to print (non-administrative CUPS tasks) \u003cstrong\u003ebut NOT\u003c/strong\u003e to create and modify queues, or delete anyone’s jobs (administrative CUPS tasks). Due to this \u003cstrong\u003ethe interface gets connected automatically\u003c/strong\u003e when your \u003ccode\u003ecups\u003c/code\u003e-plugging Snap gets loaded from the Snap Store, no special permissions required, no questions asked! Printing will “just work”.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eWhat do you have to do?\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIf you are snapping a \u003cstrong\u003enew application\u003c/strong\u003e and it has print functionality, just plug \u003ccode\u003ecups\u003c/code\u003e as described below.\u003c/li\u003e\n\u003cli\u003eIf you are \u003cstrong\u003emaintaining an application Snap\u003c/strong\u003e and for just printing you have it plugging \u003ccode\u003ecups-control\u003c/code\u003e, switch to plugging \u003ccode\u003ecups\u003c/code\u003e as described below.\u003c/li\u003e\n\u003cli\u003eIf you are creating or maintaining a \u003cstrong\u003eSnap of a printer setup tool\u003c/strong\u003e, you have to plug \u003ccode\u003ecups-control\u003c/code\u003e and live with the alternatives of manual connection or special permission of the Snap Store team.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eHow do I use it?\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eFirst, the new interface got added in \u003cstrong\u003esnapd 2.55.3\u003c/strong\u003e, the first stable release in the 2.55 series. This version is included in Ubuntu 22.04 LTS (Jammy Jellyfish) but also in the stable channel of the Snap Store, so probably it already landed on your system as an auto update.\u003c/p\u003e\n\u003cp\u003eSnapping an application with print functionality is easy, do not get turned away by the rather complicated inner workings. Especially your Snap will always talk with the CUPS Snap for all things printing, never with the system’s cupsd (it auto-installs the CUPS Snap as a dependency). This is for security. If the user has a conventional CUPS installation, the CUPS Snap works as a firewall only passing through the non-administrative requests and blocking the administrative ones and if the user uses the CUPS Snap as standard printing environment the CUPS Snap manages this by itself (see my \u003ca href=\"https://forum.snapcraft.io/t/new-interface-cups-for-all-snaps-which-print/29702/2\"\u003eexplanation of the inner workings\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eFirst, you start your snapping the same way as you are used to for applications without print functionality. Read about this part elsewhere.\u003c/p\u003e\n\u003cp\u003eSecond, in \u003ccode\u003esnapcraft.yaml\u003c/code\u003e let each app with print functionality plug the \u003ccode\u003ecups\u003c/code\u003e interface:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eapps:\n  my-printing-application:\n    command: my-printing-app\n    plugs:\n      - cups\n      - network\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eor\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eapps:\n  lp:\n    command: usr/bin/lp\n    plugs: [network, home, cups]\n  lpstat:\n    command: usr/bin/lpstat\n    plugs: [network, avahi-observe, cups]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThird, add this line to \u003ccode\u003esnapcraft.yaml\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# We need snapd 2.55 or later to have the needed support for the\n# `cups` interface in snapd\nassumes: [snapd2.55]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDo not put this into any section, put it right after the header part for example. Simply copy and paste this blob of lines as you see it here.\u003c/p\u003e\n\u003cp\u003eThese lines make your Snap require at least version 2.55 of snapd, as older versions do not have the \u003ccode\u003ecups\u003c/code\u003e interface. I assume that this triggers an auto-update of snapd if needed.\u003c/p\u003e\n\u003cp\u003eForth, add the placeholder content interface to trigger the auto-installation of the CUPS Snap. Simply add the following lines to \u003ccode\u003esnapcraft.yaml\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# this is not used or needed for anything other than to trigger automatic\n# installation of the cups snap via \"default-provider: cups\"\nplugs:\n  foo-install-cups:\n    interface: content\n    content: foo\n    default-provider: cups\n    target: $SNAP_DATA/foo\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDo not put this into any section, too, put it again right after the header part for example. Simply copy and paste the whole blob of lines as you see it here. Nothing needs to get adapted to your particular Snap, nor you have to create any directories in your Snap for that to work.\u003c/p\u003e\n\u003cp\u003eNote: Having to add these lines is only a temporary workaround. The \u003ccode\u003edefault-provider\u003c/code\u003e functionality is planned to be added to the \u003ccode\u003ecups\u003c/code\u003e interface in snapd in the coming months. When this has taken place, all what is needed to use the \u003ccode\u003ecups\u003c/code\u003e interface is plugging \u003ccode\u003ecups\u003c/code\u003e as described in the second step here and the \u003ccode\u003eassumes: [snapd2.55]\u003c/code\u003e line of the third step.\u003c/p\u003e\n\u003cp\u003eFifth, build your Snap as you are used to, test it, and upload it into the Snap Store using your habitual method. If a user installs it, the CUPS Snap gets auto-installed and the \u003ccode\u003ecups\u003c/code\u003e interface auto-connected and printing out of the Snap “just works”.\u003c/p\u003e\n\u003cp\u003eDO NOT plug both \u003ccode\u003ecups\u003c/code\u003e and \u003ccode\u003ecups-control\u003c/code\u003e in the same Snap. This can mess up things, especially as CUPS’ Snap mediation (mechanism to block administrative tasks) works “per-Snap” and not “per-application-in-the-Snap”, meaning that if one of the apps in the Snap plugs \u003ccode\u003ecups-control\u003c/code\u003e CUPS assumes the whole Snap plugging \u003ccode\u003ecups-control\u003c/code\u003e and allows all apps in the Snap to do administrative operations.\u003c/p\u003e\n\u003cp\u003eSee a \u003ca href=\"https://github.com/snapcore/test-snapd-cups-consumer\" rel=\"noopener nofollow ugc\"\u003ecomplete example here\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eInstructions originally posted in the \u003ca href=\"https://forum.snapcraft.io/t/new-interface-cups-for-all-snaps-which-print/\"\u003e\u003ccode\u003ecups\u003c/code\u003e interface launch thread\u003c/a\u003e and earlier in the \u003ca href=\"https://openprinting.github.io/OpenPrinting-News-March-2022/#cups-snap-and-snapd-printing-interface\" rel=\"noopener nofollow ugc\"\u003eOpenPrinting March 2022 News Post\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eDesign and development work discussed \u003ca href=\"https://forum.snapcraft.io/t/handling-of-the-cups-plug-by-snapd-especially-auto-connection/\"\u003ehere\u003c/a\u003e and \u003ca href=\"https://forum.snapcraft.io/t/cups-interface-merged-into-snapd-additional-steps-to-complete/\"\u003ehere\u003c/a\u003e.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2022-05-06T09:31:13.329Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":85,"reads":12,"readers_count":11,"score":417.2,"yours":false,"topic_id":29873,"topic_slug":"the-cups-interface","display_username":"Till Kamppeter","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/snapcore/test-snapd-cups-consumer","internal":false,"reflection":false,"clicks":9},{"url":"https://forum.snapcraft.io/t/new-interface-cups-for-all-snaps-which-print/29702/2","internal":true,"reflection":false,"title":"New interface: \"cups\" for all Snaps which print","clicks":1},{"url":"https://openprinting.github.io/OpenPrinting-News-March-2022/#cups-snap-and-snapd-printing-interface","internal":false,"reflection":false,"title":"OpenPrinting News - March 2022 - OpenPrinting","clicks":0},{"url":"https://forum.snapcraft.io/t/handling-of-the-cups-plug-by-snapd-especially-auto-connection/23419","internal":true,"reflection":false,"title":"Handling of the \"cups\" plug by snapd, especially auto-connection","clicks":0},{"url":"https://forum.snapcraft.io/t/new-interface-cups-for-all-snaps-which-print/29702","internal":true,"reflection":false,"title":"New interface: \"cups\" for all Snaps which print","clicks":0},{"url":"https://forum.snapcraft.io/t/cups-interface-merged-into-snapd-additional-steps-to-complete/28653","internal":true,"reflection":false,"title":"\"cups\" interface merged into snapd - Additional steps to complete","clicks":0},{"url":"http://www.openprinting.org/","internal":false,"reflection":false,"clicks":0},{"url":"https://forum.snapcraft.io/t/the-cups-interface/26453","internal":true,"reflection":true,"title":"The cups interface","clicks":1},{"url":"https://forum.snapcraft.io/t/new-interface-cups-for-all-snaps-which-print/29702/4","internal":true,"reflection":true,"title":"New interface: \"cups\" for all Snaps which print","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":644,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[109032]},"timeline_lookup":[[1,406]],"suggested_topics":[{"id":31214,"title":"ROS 2 shared memory in snaps","fancy_title":"ROS 2 shared memory in snaps","slug":"ros-2-shared-memory-in-snaps","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-08-09T13:28:52.600Z","last_posted_at":"2022-08-23T09:55:20.580Z","bumped":true,"bumped_at":"2022-08-23T09:55:20.580Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":1,"views":1271,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":11989,"username":"gbeuzeboc","name":"","avatar_template":"/letter_avatar/gbeuzeboc/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":30905,"title":"Snapcraft documentation","fancy_title":"Snapcraft documentation","slug":"snapcraft-documentation","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-15T11:05:45.374Z","last_posted_at":"2022-07-15T11:05:45.528Z","bumped":true,"bumped_at":"2023-02-17T19:55:21.024Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1532,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":34740,"title":"Super-privileged interfaces","fancy_title":"Super-privileged interfaces","slug":"super-privileged-interfaces","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2023-04-14T09:20:24.510Z","last_posted_at":"2023-04-14T09:20:24.656Z","bumped":true,"bumped_at":"2023-04-14T09:29:53.927Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":260,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":31037,"title":"Snapcraft Tutorials","fancy_title":"Snapcraft Tutorials","slug":"snapcraft-tutorials","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-26T17:19:27.439Z","last_posted_at":"2022-07-26T17:19:27.549Z","bumped":true,"bumped_at":"2023-04-05T08:33:18.861Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1214,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":31051,"title":"Snapcraft Reference","fancy_title":"Snapcraft Reference","slug":"snapcraft-reference","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-07-27T11:51:00.654Z","last_posted_at":"2023-04-24T17:52:24.772Z","bumped":true,"bumped_at":"2023-04-25T05:31:27.608Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1238,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":11710,"username":"rpjday","name":"Robert P. J. Day","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":2185,"username":"abitrolly","name":"Anatoli Babenia","avatar_template":"/user_avatar/forum.snapcraft.io/abitrolly/{size}/4528_2.png"}}]}],"tags":[],"id":29873,"title":"The \"cups\" Interface","fancy_title":"The \u0026ldquo;cups\u0026rdquo; Interface","posts_count":1,"created_at":"2022-05-06T09:31:13.141Z","views":602,"reply_count":0,"like_count":0,"last_posted_at":"2022-05-06T09:31:13.329Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"the-cups-interface","category_id":15,"word_count":1035,"deleted_at":null,"user_id":644,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_29873","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":1,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"details":{"notification_level":1,"participants":[{"id":644,"username":"till.kamppeter","name":"Till Kamppeter","avatar_template":"/user_avatar/forum.snapcraft.io/till.kamppeter/{size}/3687_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null}],"created_by":{"id":644,"username":"till.kamppeter","name":"Till Kamppeter","avatar_template":"/user_avatar/forum.snapcraft.io/till.kamppeter/{size}/3687_2.png"},"last_poster":{"id":644,"username":"till.kamppeter","name":"Till Kamppeter","avatar_template":"/user_avatar/forum.snapcraft.io/till.kamppeter/{size}/3687_2.png"},"links":[{"url":"https://github.com/snapcore/test-snapd-cups-consumer","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":9,"user_id":644,"domain":"github.com","root_domain":"github.com"},{"url":"https://forum.snapcraft.io/t/new-interface-cups-for-all-snaps-which-print/29702/2","title":"New interface: \"cups\" for all Snaps which print","internal":true,"attachment":false,"reflection":false,"clicks":1,"user_id":644,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/the-cups-interface/26453","title":"The cups interface","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":2772,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"}]}}