{"post_stream":{"posts":[{"id":55599,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2019-09-24T21:19:18.319Z","cooked":"\u003cp\u003eSystem usernames can be used by snap developers to enable them to run \u003ca href=\"https://forum.snapcraft.io/t/services-and-daemons/12601\"\u003eservices and daemons\u003c/a\u003e as a user other than the default \u003ccode\u003eroot\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eOutside of snaps, applications traditionally adopt the concept of users and groups from the host operating system to use as a security mechanism that grants access to specific system and software resources.\u003c/p\u003e\n\u003cp\u003eSnap confinement prohibits a system’s users and groups from being used in this way within a snap but a \u003cem\u003esnap_daemon\u003c/em\u003e user and group can alternatively be created within a snap to provide similar user and group level control outside of a snap’s confinement.\u003c/p\u003e\n\u003ch2 id=\"heading--snap_daemon\"\u003esnap_daemon user and group\u003c/h2\u003e\n\u003cp\u003eFrom version 2.41 onwards, snapd supports the creation of a \u003ccode\u003esnap_daemon\u003c/code\u003e user and group within a snap, exposed as user ID (UID) and group ID (GID) \u003ccode\u003e584788\u003c/code\u003e on the host system.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://forum.snapcraft.io/images/emoji/emoji_one/information_source.png?v=9\" title=\":information_source:\" class=\"emoji\" alt=\":information_source:\"\u003e Future releases of snapd will support more users and groups.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eTo create the \u003ccode\u003esnap_daemon\u003c/code\u003e user/group inside a snap, add the following \u003ccode\u003esystem-usernames\u003c/code\u003e section to the snap’s \u003ca href=\"/t/snapcraft-yaml-reference/4276\"\u003esnapcraft.yaml\u003c/a\u003e (or\n\u003ccode\u003esnap.yaml\u003c/code\u003e):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003esystem-usernames:\n  snap_daemon: shared\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWith the above added, the \u003ccode\u003e584788\u003c/code\u003e user and group can be used by a snap via standard APIs (eg, \u003ccode\u003egetpwent()\u003c/code\u003e, the \u003ccode\u003egetent\u003c/code\u003e command, etc) to perform various ownership (eg, \u003ccode\u003echown()\u003c/code\u003e and \u003ccode\u003echgrp()\u003c/code\u003e) and privilege separation operations (eg, \u003ccode\u003esetuid()\u003c/code\u003e and \u003ccode\u003esetgid()\u003c/code\u003e).\u003c/p\u003e\n\u003ch2\u003eUsage considerations\u003c/h2\u003e\n\u003cp\u003eIn general, the snap may use the allocated system username as desired. However, due to snapd’s security sandbox, the snap may need to be adjusted to work reliably.\u003c/p\u003e\n\u003cp\u003eUsing \u003ccode\u003esystem-usernames\u003c/code\u003e allows a snap to drop privileges and transition to the specified user, but the daemon will still start as root and be started from systemd on boot.\u003c/p\u003e\n\u003ch3\u003eDropping privileges\u003c/h3\u003e\n\u003cp\u003eSecurity best practice dictates that applications drop privileges as follows:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e// Error messages, etc., omitted for clarity\nchar *user = \"snap_daemon\";\nstruct passwd *pwd = getpwnam(user);\nif (pwd == NULL) {\n    exit(1);\n}\nif (setgroups(0, NULL) \u0026lt; 0) {\n    exit(1);\n}\nif (setgid(pwd-\u0026gt;pw_gid) \u0026lt; 0) {\n    exit(1);\n}\nif (setuid(pwd-\u0026gt;pw_uid) \u0026lt; 0) {\n    exit(1);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe observant reader will notice that the call to \u003ccode\u003esetgroups()\u003c/code\u003e uses the non-portable, Linux-specific, invocation  \u003cem\u003esize 0\u003c/em\u003e and \u003cem\u003eNULL list\u003c/em\u003e to clear the list completely. This contrasts with a more portable \u003cem\u003esize 1\u003c/em\u003e and a list consisting of the single primary group. This is due to current sandbox limitations. If desired, \u003ccode\u003esetgroups()\u003c/code\u003e may be overridden via LD_PRELOAD. See the \u003ca href=\"https://git.launchpad.net/~jdstrand/+git/test-setgroups/tree/\"\u003etest-setgroups snap\u003c/a\u003e for an example).\u003c/p\u003e\n\u003cp\u003eFor those using \u003ccode\u003ebase: core18\u003c/code\u003e or higher, the \u003ccode\u003esetpriv\u003c/code\u003e command may be used to drop privileges like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$SNAP/usr/bin/setpriv --clear-groups --reuid snap_daemon \\\n  --regid snap_daemon -- \u0026lt;your command\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ebase: core18\u003c/code\u003e snaps should stage \u003ccode\u003esetpriv\u003c/code\u003e while \u003ccode\u003ebase: core20\u003c/code\u003e should stage \u003ccode\u003eutil-linux\u003c/code\u003e. On snapd \u0026lt; 2.45, LD_PRELOAD is still needed due to how the sandbox is configured and how \u003ccode\u003esetpriv --clear-groups\u003c/code\u003e is using \u003ccode\u003esetgroups(0, \u0026lt;NON_NULL\u0026gt;)\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eLD_PRELOAD=$SNAP_COMMON/wraplib.so $SNAP/usr/bin/setpriv \\\n  --clear-groups --reuid snap_daemon --regid snap_daemon -- \u0026lt;your command\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSome applications may try to drop privileges themselves using \u003ccode\u003einitgroups()\u003c/code\u003e which under the hood uses \u003ccode\u003esetgroups()\u003c/code\u003e in a way that is blocked by the sandbox. In this case, the snap would need to use the LD_PRELOAD method. See the \u003ca href=\"https://git.launchpad.net/~jdstrand/+git/test-setpriv/tree/\"\u003etest-setpriv snap\u003c/a\u003e for how to use \u003ccode\u003esetpriv\u003c/code\u003e with and without LD_PRELOAD.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://forum.snapcraft.io/images/emoji/emoji_one/information_source.png?v=9\" title=\":information_source:\" class=\"emoji\" alt=\":information_source:\"\u003e Future releases of snapd will support setting \u003ccode\u003eUser=snap_daemon\u003c/code\u003e and \u003ccode\u003eGroup=snap_daemon\u003c/code\u003e in the systemd unit file.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003eProcess management via signals\u003c/h2\u003e\n\u003cp\u003eBy default, a snap’s security sandbox limits the sending and receiving of signals to processes in the snap where the sender and the receiver have the same owner, even when the process runs as root (unless the process has CAP_KILL).\u003c/p\u003e\n\u003cp\u003eWhen developing a snap, care must therefore be taken to drop privileges \u003cem\u003ebefore\u003c/em\u003e sending a signal to a process that has privilege dropped.\u003c/p\u003e\n\u003cp\u003eFor example, a management process that runs as root may fork off worker processes that drop privileges to the snap_daemon user. Whenever this management process wants to send a signal to its workers, it must drop privileges to the snap_daemon user first. Alternatively, the snap could use \u003ccode\u003eplugs: [ process-control ]\u003c/code\u003e, which among other things, grants CAP_KILL.\u003c/p\u003e\n\u003cp\u003eSince the \u003ca href=\"https://snapcraft.io/docs/process-control-interface\"\u003eprocess-control\u003c/a\u003e interface grants considerable access for system-wide process management, best practice dictates that privileges \u003cem\u003emust\u003c/em\u003e be dropped as needed when sending signals to other processes in the snap.\u003c/p\u003e\n\u003ch2\u003eOwnership (discretionary access controls)\u003c/h2\u003e\n\u003cp\u003eThe security sandbox generally limits file access to where the object id of the file (ie, the owner) matches the uid of the running process. This is true even for root, unless the process has CAP_DAC_OVERRIDE or CAP_DAC_READ_SEARCH defined, which the security sandbox intentionally denies.\u003c/p\u003e\n\u003cp\u003eAs such, care must be taken when creating files after dropping privileges \u003cem\u003eif\u003c/em\u003e those files are intended to be accessed by other processes in the snap that have not had their privileges dropped.\u003c/p\u003e\n\u003cp\u003eWhile each snap’s requirements may differ, in general, a reasonable approach is to create files and directories with \u003ccode\u003e\u0026lt;dropped user\u0026gt;:root\u003c/code\u003e ownership, allowing owner and group read and write. This allows allows both the \u003cem\u003eprivilege dropped\u003c/em\u003e user and the \u003cem\u003eroot\u003c/em\u003e user within the snap to access to the files.\u003c/p\u003e\n\u003cp\u003eFor example, if the snap utilises the \u003ccode\u003esnap_daemon\u003c/code\u003e user, the snap might (as part of a configure hook or a wrapper script, for instance) do:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eif [ ! -d \"$SNAP_DATA/dir\" ]; then\n    mkdir \"$SNAP_DATA/dir\"\n    chmod 770 \"$SNAP_DATA/dir\" # must be before chown\n    chown snap_daemon \"$SNAP_DATA/dir\"\n    chgrp root \"$SNAP_DATA/dir\"  # not needed but shown for clarity\nfi\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSecurity best practice dictates file access should be performed with the minimal privileges necessarily, so the snap is of course free to privilege-drop prior to accessing the file instead.\u003c/p\u003e\n\u003ch2\u003esubuid, subgid and other container technologies\u003c/h2\u003e\n\u003cp\u003eSnapd takes great care to avoid overlapping with other container technologies (or in the case of systemd, working with \u003ca href=\"https://github.com/systemd/systemd/blob/master/docs/UIDS-GIDS.md\"\u003e\u003ccode\u003esystemd-nspawn\u003c/code\u003e's collision detection\u003c/a\u003e). It uses the \u003ccode\u003e524288-589823\u003c/code\u003e UID/GID range, for instance, to help avoid the default ranges for LXD, Docker and other container systems.\u003c/p\u003e\n\u003cp\u003eSome administrators may adjust their non-snap container runtimes to use non-default values (eg, via \u003ccode\u003e/etc/subuid\u003c/code\u003e, \u003ccode\u003e/etc/subgid\u003c/code\u003e, etc). While it is non-fatal for other container ranges to overlap with snapd’s range, best practice dictates that a different range should always be used to ensure a clean separation between snapd and other container ranges in the kernel on the system.\u003c/p\u003e\n\u003ch1\u003eReferences\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://forum.snapcraft.io/t/multiple-users-and-groups-in-snaps/1461\" class=\"inline-onebox\"\u003eMultiple users and groups in snaps\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","post_number":1,"post_type":1,"updated_at":"2022-03-18T13:24:10.568Z","reply_count":3,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1332,"reads":129,"readers_count":128,"score":6717.8,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":14,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/multiple-users-and-groups-in-snaps/1461","internal":true,"reflection":false,"title":"Multiple users and groups in snaps","clicks":56},{"url":"https://forum.snapcraft.io/t/snapcraft-yaml-reference/4276","internal":true,"reflection":false,"title":"Snapcraft.yaml reference","clicks":16},{"url":"https://git.launchpad.net/~jdstrand/+git/test-setpriv/tree/","internal":false,"reflection":false,"title":"~jdstrand/+git/test-setpriv - [no description]","clicks":11},{"url":"https://git.launchpad.net/~jdstrand/+git/test-setgroups/tree/","internal":false,"reflection":false,"title":"~jdstrand/+git/test-setgroups - [no description]","clicks":11},{"url":"https://forum.snapcraft.io/t/services-and-daemons/12601","internal":true,"reflection":false,"title":"Services and daemons","clicks":9},{"url":"https://snapcraft.io/docs/process-control-interface","internal":false,"reflection":false,"clicks":3},{"url":"https://github.com/systemd/systemd/blob/master/docs/UIDS-GIDS.md","internal":false,"reflection":false,"title":"systemd/UIDS-GIDS.md at master · systemd/systemd · GitHub","clicks":2},{"url":"https://forum.snapcraft.io/t/can-a-confined-snap-run-as-a-different-uid-and-or-guid/18057/2","internal":true,"reflection":true,"title":"Can a confined Snap run as a different uid and or guid?","clicks":7},{"url":"https://forum.snapcraft.io/t/multiple-users-and-groups-in-snaps/1461/24","internal":true,"reflection":true,"title":"Multiple users and groups in snaps","clicks":2},{"url":"https://forum.snapcraft.io/t/log-observe-autoconnect-request-for-soscleaner/17072/9","internal":true,"reflection":true,"title":"Log-observe autoconnect request for soscleaner","clicks":0},{"url":"https://forum.snapcraft.io/t/requesting-exception-for-use-of-browser-support-plug-with-daemon/29917/4","internal":true,"reflection":true,"title":"Requesting exception for use of 'browser-support' plug with daemon","clicks":0},{"url":"https://forum.snapcraft.io/t/slurm-snap-classic-confinement/17128/5","internal":true,"reflection":true,"title":"Slurm Snap Classic Confinement","clicks":0},{"url":"https://forum.snapcraft.io/t/interface-request-cups-control-on-cups-snap-and-including-d-bus/15233/9","internal":true,"reflection":true,"title":"Interface request: \"cups-control\" on CUPS snap and including D-Bus","clicks":0},{"url":"https://forum.snapcraft.io/t/release-notes-snapcraft-3-10/15773","internal":true,"reflection":true,"title":"Release notes: Snapcraft 3.10","clicks":0},{"url":"https://forum.snapcraft.io/t/phase-1-of-opt-in-per-snap-users-groups-aka-the-daemon-user/10624/20","internal":true,"reflection":true,"title":"Phase 1 of 'Opt-in per-snap users/groups' (aka, the 'daemon' user)","clicks":0},{"url":"https://forum.snapcraft.io/t/problem-with-releasing-kiosk-app/14861/8","internal":true,"reflection":true,"title":"Problem with releasing kiosk app","clicks":0},{"url":"https://forum.snapcraft.io/t/browser-support-with-daemon-needing-manual-review/10410/15","internal":true,"reflection":true,"title":"Browser support with daemon - needing manual review","clicks":0},{"url":"https://forum.snapcraft.io/t/how-should-i-run-alsa-inside-daemon-snap/17800","internal":true,"reflection":true,"title":"How should I run ALSA inside daemon snap","clicks":0},{"url":"https://forum.snapcraft.io/t/manual-review-pending/26797/3","internal":true,"reflection":true,"title":"manual review pending","clicks":0},{"url":"https://forum.snapcraft.io/t/snap-documentation/11127","internal":true,"reflection":true,"title":"Snap documentation","clicks":0},{"url":"https://forum.snapcraft.io/t/failure-to-refresh-the-telegraf-snap-on-on-kubernetes-hosts/22497/2","internal":true,"reflection":true,"title":"Failure to refresh the telegraf snap on on kubernetes hosts","clicks":0},{"url":"https://forum.snapcraft.io/t/snaps-and-the-owner-permission/21085/4","internal":true,"reflection":true,"title":"Snaps and the owner Permission","clicks":0},{"url":"https://forum.snapcraft.io/t/can-not-install-microstack-snap-from-20-10/20905","internal":true,"reflection":true,"title":"Can not install MicroStack snap from 20.10","clicks":0},{"url":"https://forum.snapcraft.io/t/snapcraft-top-level-metadata/8334","internal":true,"reflection":true,"title":"Snapcraft top-level metadata","clicks":0},{"url":"https://forum.snapcraft.io/t/request-for-daemon-browser-support-for-krellian-kiosk/18873/4","internal":true,"reflection":true,"title":"Request for daemon + browser-support for krellian-kiosk","clicks":0},{"url":"https://forum.snapcraft.io/t/request-for-daemon-browser-support-for-krellian-kiosk/18873/2","internal":true,"reflection":true,"title":"Request for daemon + browser-support for krellian-kiosk","clicks":0},{"url":"https://forum.snapcraft.io/t/request-for-classic-confinement-slurm/18309/10","internal":true,"reflection":true,"title":"Request for Classic confinement: Slurm","clicks":0},{"url":"https://forum.snapcraft.io/t/request-for-classic-confinement-slurm/18309/5","internal":true,"reflection":true,"title":"Request for Classic confinement: Slurm","clicks":0},{"url":"https://forum.snapcraft.io/t/request-for-classic-confinement-slurm/18309/4","internal":true,"reflection":true,"title":"Request for Classic confinement: Slurm","clicks":0},{"url":"https://forum.snapcraft.io/t/request-for-classic-confinement-slurm/18309/3","internal":true,"reflection":true,"title":"Request for Classic confinement: Slurm","clicks":0}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[{"id":2,"count":3}],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":true,"last_wiki_edit":"2022-03-18T13:24:10.607Z","can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":59520,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2019-12-03T22:38:57.258Z","cooked":"\u003cp\u003eFYI, some have reported that \u003ca href=\"https://github.com/tianon/gosu\"\u003egosu\u003c/a\u003e works well for privilege dropping.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2019-12-03T22:38:57.258Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":90,"readers_count":89,"score":43.0,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/tianon/gosu","internal":false,"reflection":false,"title":"GitHub - tianon/gosu: Simple Go-based setuid+setgid+setgroups+exec","clicks":9}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":62048,"name":"Merlijn Sebrechts","username":"galgalesh","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png","created_at":"2020-01-25T20:45:24.674Z","cooked":"\u003cp\u003eI’m trying this feature out, but I’m getting weird permission denied errors.\u003c/p\u003e\n\u003cp\u003eThe root account \u003cem\u003einside of the snap\u003c/em\u003e cannot access files owned by \u003ccode\u003esnap_daemon\u003c/code\u003e in \u003ccode\u003e$SNAP_USER_DATA\u003c/code\u003e, regardless on the permissions of those files.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eroot@howard:/home/merlijn# ls -al /root/snap/easy-openvpn-server/x8/openvpn-server1-status.log\n-rw-rw-rw- 1 snap_daemon snap_daemon 232 Jan 25 21:30 /root/snap/easy-openvpn-server/x8/openvpn-server1-status.log\nroot@howard:/home/merlijn# cat /root/snap/easy-openvpn-server/x8/openvpn-server1-status.log\ncat: /root/snap/easy-openvpn-server/x8/openvpn-server1-status.log: Permission denied\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt’s the same issue the other way around. Inside of the snap, the \u003ccode\u003esnap_daemon\u003c/code\u003e user does not seem to be able to access files owned by root, regardless of their permissions.\u003c/p\u003e\n\u003cp\u003eOutside of the snap, everything appears normal; root account can access \u003ccode\u003esnap_daemon\u003c/code\u003e files.\u003c/p\u003e\n\u003cp\u003eFor my OpenVPN snap, I need the status file to be accessible to both \u003ccode\u003eroot\u003c/code\u003e and \u003ccode\u003esnap_daemon\u003c/code\u003e, since the former opens the file and, after OpenVPN drops privileges, the latter truncates the file.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2020-01-25T21:08:13.007Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":3,"reads":79,"readers_count":78,"score":35.8,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Merlijn Sebrechts","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1418,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":62052,"name":"Ian Johnson","username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png","created_at":"2020-01-26T00:11:26.856Z","cooked":"\u003cp\u003eThis is expected for most paths as many AppArmor rules for snaps specify \u003ccode\u003eowner\u003c/code\u003e which means that only the owner of the file/path can access that file. What specific paths are you trying to access?\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2020-01-26T00:11:26.856Z","reply_count":1,"reply_to_post_number":4,"quote_count":0,"incoming_link_count":0,"reads":71,"readers_count":70,"score":19.2,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Ian Johnson","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"galgalesh","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png"},"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":2438,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":62060,"name":"Merlijn Sebrechts","username":"galgalesh","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png","created_at":"2020-01-26T13:10:09.567Z","cooked":"\u003cp\u003eI’m trying to access \u003ccode\u003e$SNAP_USER_DATA/openvpn-server1-status.log\u003c/code\u003e (the snap should run as root). However, I can configure OpenVPN to use any path, as long as it is writeable by both \u003ccode\u003eroot\u003c/code\u003e and \u003ccode\u003esnap_daemon\u003c/code\u003e. It’s a status file that the daemon uses to show how many users are connected to the VPN etc… The daemon opens it before dropping privileges and writes/truncates the file after dropping privileges.\u003c/p\u003e\n\u003cp\u003eI would expect a snap to have full access to its \u003ccode\u003e$SNAP_USER_DATA\u003c/code\u003e. Is there another path I should be using?\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2020-01-26T13:14:33.155Z","reply_count":1,"reply_to_post_number":5,"quote_count":0,"incoming_link_count":1,"reads":69,"readers_count":68,"score":23.8,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Merlijn Sebrechts","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1418,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":62082,"name":"Ian Johnson","username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png","created_at":"2020-01-27T15:05:54.508Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"galgalesh\" data-post=\"6\" data-topic=\"13386\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/galgalesh/40/5329_2.png\" class=\"avatar\"\u003e galgalesh:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI would expect a snap to have full access to its \u003ccode\u003e$SNAP_USER_DATA\u003c/code\u003e . Is there another path I should be using?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eWell it does, for a particular user. snap_daemon has full access to its $SNAP_USER_DATA, and root has full access to its $SNAP_USER_DATA, just they don’t have access to each others. Looking at the default AppArmor profile for a snap, we can see that $SNAP_USER_DATA has an owner rule:\u003c/p\u003e\n\u003caside class=\"onebox githubblob\"\u003e\n  \u003cheader class=\"source\"\u003e\n      \u003ca href=\"https://github.com/snapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L417-L420\" target=\"_blank\" rel=\"noopener\"\u003egithub.com\u003c/a\u003e\n  \u003c/header\u003e\n  \u003carticle class=\"onebox-body\"\u003e\n    \u003ch4\u003e\u003ca href=\"https://github.com/snapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L417-L420\" target=\"_blank\" rel=\"noopener\"\u003esnapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L417-L420\u003c/a\u003e\u003c/h4\u003e\n\u003cpre class=\"onebox\"\u003e\u003ccode class=\"lang-go\"\u003e\u003col class=\"start lines\" start=\"417\" style=\"counter-reset: li-counter 416 ;\"\u003e\n\u003cli\u003e# Writable home area for this version.\u003c/li\u003e\u003cli\u003e# bind mount *not* used here (see 'parallel installs', above)\u003c/li\u003e\u003cli\u003eowner @{HOME}/snap/@{SNAP_INSTANCE_NAME}/@{SNAP_REVISION}/** wl,\u003c/li\u003e\u003cli\u003eowner @{HOME}/snap/@{SNAP_INSTANCE_NAME}/common/** wl,\u003c/li\u003e\n\u003c/ol\u003e\u003c/code\u003e\u003c/pre\u003e\n\n\n  \u003c/article\u003e\n  \u003cdiv class=\"onebox-metadata\"\u003e\n    \n    \n  \u003c/div\u003e\n  \u003cdiv style=\"clear: both\"\u003e\u003c/div\u003e\n\u003c/aside\u003e\n\n\u003cp\u003ewhile $SNAP_DATA does not have this owner rule:\u003c/p\u003e\n\u003caside class=\"onebox githubblob\"\u003e\n  \u003cheader class=\"source\"\u003e\n      \u003ca href=\"https://github.com/snapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L427-L430\" target=\"_blank\" rel=\"noopener\"\u003egithub.com\u003c/a\u003e\n  \u003c/header\u003e\n  \u003carticle class=\"onebox-body\"\u003e\n    \u003ch4\u003e\u003ca href=\"https://github.com/snapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L427-L430\" target=\"_blank\" rel=\"noopener\"\u003esnapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L427-L430\u003c/a\u003e\u003c/h4\u003e\n\u003cpre class=\"onebox\"\u003e\u003ccode class=\"lang-go\"\u003e\u003col class=\"start lines\" start=\"427\" style=\"counter-reset: li-counter 426 ;\"\u003e\n\u003cli\u003e# Writable system area only for this version\u003c/li\u003e\u003cli\u003e# bind mount used here (see 'parallel installs', above)\u003c/li\u003e\u003cli\u003e/var/snap/{@{SNAP_NAME},@{SNAP_INSTANCE_NAME}}/@{SNAP_REVISION}/** wl,\u003c/li\u003e\u003cli\u003e/var/snap/{@{SNAP_NAME},@{SNAP_INSTANCE_NAME}}/common/** wl,\u003c/li\u003e\n\u003c/ol\u003e\u003c/code\u003e\u003c/pre\u003e\n\n\n  \u003c/article\u003e\n  \u003cdiv class=\"onebox-metadata\"\u003e\n    \n    \n  \u003c/div\u003e\n  \u003cdiv style=\"clear: both\"\u003e\u003c/div\u003e\n\u003c/aside\u003e\n\n\u003cp\u003eSo what I would recommend you to do is to use $SNAP_DATA, but as root (i.e. before dropping privs to snap_damon), chown that directory as snap_daemon so that it can write to $SNAP_DATA, as normally only root can write to $SNAP_DATA.\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2020-01-27T15:05:54.508Z","reply_count":1,"reply_to_post_number":6,"quote_count":1,"incoming_link_count":3,"reads":71,"readers_count":70,"score":49.2,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Ian Johnson","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/snapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L417-L420","internal":false,"reflection":false,"title":"snapd/template.go at cf7c1792f9fd37694b8cf786deec07ef66b25b27 · snapcore/snapd · GitHub","clicks":2},{"url":"https://github.com/snapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L427-L430","internal":false,"reflection":false,"title":"snapd/template.go at cf7c1792f9fd37694b8cf786deec07ef66b25b27 · snapcore/snapd · GitHub","clicks":0}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":true,"admin":false,"staff":true,"user_id":2438,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":62083,"name":"Ian Johnson","username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png","created_at":"2020-01-27T15:06:41.087Z","cooked":"\u003cp\u003eActually, reading this page, this is explained under the section:\u003c/p\u003e\n\u003caside class=\"quote no-group\" data-username=\"jdstrand\" data-post=\"1\" data-topic=\"13386\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/jdstrand/40/6376_2.png\" class=\"avatar\"\u003e jdstrand:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003ch2\u003eOwnership (discretionary access controls)\u003c/h2\u003e\n\u003cp\u003eThe security sandbox generally limits file access to where the object id of the file (ie, the owner) matches the uid of the running process. This is true even for root, unless the process has CAP_DAC_OVERRIDE or CAP_DAC_READ_SEARCH defined, which the security sandbox intentionally denies.\u003c/p\u003e\n\u003cp\u003eAs such, care must be taken when creating files after dropping privileges \u003cem\u003eif\u003c/em\u003e those files are intended to be accessed by other processes in the snap that have not had their privileges dropped.\u003c/p\u003e\n\u003cp\u003eWhile each snap’s requirements may differ, in general, a reasonable approach is to create files and directories with \u003ccode\u003e\u0026lt;dropped user\u0026gt;:root\u003c/code\u003e ownership, allowing owner and group read and write. This allows allows both the \u003cem\u003eprivilege dropped\u003c/em\u003e user and the \u003cem\u003eroot\u003c/em\u003e user within the snap to access to the files.\u003c/p\u003e\n\u003cp\u003eFor example, if the snap utilises the \u003ccode\u003esnap_daemon\u003c/code\u003e user, the snap might (as part of a configure hook or a wrapper script, for instance) do:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eif [ ! -d \"$SNAP_DATA/dir\" ]; then\n    mkdir \"$SNAP_DATA/dir\"\n    chmod 770 \"$SNAP_DATA/dir\" # must be before chown\n    chown snap_daemon \"$SNAP_DATA/dir\"\n    chgrp root \"$SNAP_DATA/dir\"  # not needed but shown for clarity\nfi\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSecurity best practice dictates file access should be performed with the minimal privileges necessarily, so the snap is of course free to privilege-drop prior to accessing the file instead.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e","post_number":8,"post_type":1,"updated_at":"2020-01-27T15:06:41.087Z","reply_count":0,"reply_to_post_number":7,"quote_count":1,"incoming_link_count":4,"reads":70,"readers_count":69,"score":49.0,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Ian Johnson","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":true,"admin":false,"staff":true,"user_id":2438,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":62748,"name":"Casey Marshall","username":"cmars","avatar_template":"/letter_avatar/cmars/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png","created_at":"2020-02-08T19:57:28.562Z","cooked":"\u003cp\u003eI have existing snaps that install services with \u003ccode\u003e$SNAP_COMMON\u003c/code\u003e set up as their base directory for config files, state, etc. In order to migrate these existing installs to a newer version of the snap that uses the snap_daemon user, would it be enough to \u003ccode\u003echown -R snap_daemon $SNAP_COMMON\u003c/code\u003e – or will I need to use a subdirectory of \u003ccode\u003e$SNAP_COMMON\u003c/code\u003e?\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2020-02-08T19:57:28.562Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":66,"readers_count":65,"score":28.2,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Casey Marshall","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":259,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":69814,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2020-05-14T19:06:14.132Z","cooked":"\u003cp\u003eFYI, with snapd 2.45 you can use the \u003ccode\u003esetpriv\u003c/code\u003e command from the util-linux package to drop privileges without needing a separate LD_PRELOAD. See the updated “Dropping Privileges” (above) for more details.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2020-05-14T19:55:56.484Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":60,"readers_count":59,"score":32.0,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":69820,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2020-05-14T19:55:32.008Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"cmars\" data-post=\"9\" data-topic=\"13386\" data-full=\"true\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/letter_avatar/cmars/40/5_6d6f4cde2641c35611d5cac2fb97c77e.png\" class=\"avatar\"\u003e cmars:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eI have existing snaps that install services with \u003ccode\u003e$SNAP_COMMON\u003c/code\u003e set up as their base directory for config files, state, etc. In order to migrate these existing installs to a newer version of the snap that uses the snap_daemon user, would it be enough to \u003ccode\u003echown -R snap_daemon $SNAP_COMMON\u003c/code\u003e – or will I need to use a subdirectory of \u003ccode\u003e$SNAP_COMMON\u003c/code\u003e ?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eSnaps are not allowed to modify the ownership of SNAP_COMMON (or SNAP_DATA, etc), so no, this wouldn’t work. You should be able to use \u003ccode\u003echown -R ... $SNAP_COMMON/*\u003c/code\u003e though (perhaps in a refresh hook).\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2020-05-14T19:55:32.008Z","reply_count":0,"reply_to_post_number":9,"quote_count":1,"incoming_link_count":7,"reads":59,"readers_count":58,"score":36.8,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":83367,"name":"Emilio Lopez","username":"lopezem","avatar_template":"/user_avatar/forum.snapcraft.io/lopezem/{size}/5389_2.png","created_at":"2020-12-02T17:46:08.793Z","cooked":"\u003cp\u003eI see that there is a \u003ca href=\"https://github.com/anonymouse64/postgres-snap\" rel=\"noopener nofollow ugc\"\u003epostgres snap example\u003c/a\u003e that makes the use of \u003ccode\u003egosu\u003c/code\u003e command. After installing and running this on an Ubuntu Core, the \u003ccode\u003egosu\u003c/code\u003e command fails when attempting to run as \u003ccode\u003esnap_daemon\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eerror: failed switching to \"snap_daemon\": unable to find user snap_daemon: no matching entries in passwd file\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is using snapd 2.47.1\u003c/p\u003e\n\u003cp\u003eI can \u003ccode\u003echown\u003c/code\u003e of a certain directory/file to \u003ccode\u003esnap_daemon\u003c/code\u003e but cannot run any scripts/binaries as the \u003ccode\u003esnap_daemon\u003c/code\u003e user. Has anyone have luck doing this?\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2020-12-02T17:48:19.988Z","reply_count":1,"reply_to_post_number":2,"quote_count":0,"incoming_link_count":1,"reads":45,"readers_count":44,"score":19.0,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Emilio Lopez","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/anonymouse64/postgres-snap","internal":false,"reflection":false,"title":"GitHub - anonymouse64/postgres-snap: Strictly confined snap of postgres using new system-usernames snapd feature","clicks":4}],"read":true,"user_title":null,"reply_to_user":{"username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":2677,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":83369,"name":"Ian Johnson","username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png","created_at":"2020-12-02T17:57:51.848Z","cooked":"\u003cp\u003eHi, I need to update this example snap to use \u003ccode\u003esetpriv\u003c/code\u003e instead which works on all systems and doesn’t have the same problem as gosu, if you wouldn’t mind could you file an issue on the github repo for me to fix that snap?\u003c/p\u003e\n\u003cp\u003eIndependently the docs here should probably not reference gosu due to the fact it doesn’t work on Ubuntu Core.\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2020-12-02T17:58:37.111Z","reply_count":1,"reply_to_post_number":13,"quote_count":0,"incoming_link_count":0,"reads":44,"readers_count":43,"score":13.8,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Ian Johnson","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"lopezem","avatar_template":"/user_avatar/forum.snapcraft.io/lopezem/{size}/5389_2.png"},"bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":2438,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":83383,"name":"Emilio Lopez","username":"lopezem","avatar_template":"/user_avatar/forum.snapcraft.io/lopezem/{size}/5389_2.png","created_at":"2020-12-02T20:08:01.471Z","cooked":"\u003cp\u003eDone. It appears that the setpriv works as an alternative. Thanks.\u003c/p\u003e","post_number":15,"post_type":1,"updated_at":"2020-12-02T20:08:01.471Z","reply_count":0,"reply_to_post_number":14,"quote_count":0,"incoming_link_count":1,"reads":43,"readers_count":42,"score":28.6,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Emilio Lopez","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":2677,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":94021,"name":"Alberto Mardegan","username":"mardy","avatar_template":"/user_avatar/forum.snapcraft.io/mardy/{size}/7599_2.png","created_at":"2021-06-09T08:21:17.117Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"jdstrand\" data-post=\"1\" data-topic=\"13386\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/jdstrand/40/6376_2.png\" class=\"avatar\"\u003e jdstrand:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWith the above added, the \u003ccode\u003e584788\u003c/code\u003e user and group can be used by a snap via standard APIs\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI don’t understand why this number is here. Maybe it was meant to be “\u003ccode\u003esnap_daemon\u003c/code\u003e” instead?\u003c/p\u003e","post_number":16,"post_type":1,"updated_at":"2021-06-09T08:21:17.117Z","reply_count":1,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":0,"reads":38,"readers_count":37,"score":12.6,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Alberto Mardegan","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":10076,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":94022,"name":"Oliver Grawert","username":"ogra","avatar_template":"/user_avatar/forum.snapcraft.io/ogra/{size}/22_2.png","created_at":"2021-06-09T08:33:41.359Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"jdstrand\" data-post=\"1\" data-topic=\"13386\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/jdstrand/40/6376_2.png\" class=\"avatar\"\u003e jdstrand:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eFrom version 2.41 onwards, snapd supports the creation of a \u003ccode\u003esnap_daemon\u003c/code\u003e user and group within a snap, exposed as user ID (UID) and group ID (GID) \u003ccode\u003e584788\u003c/code\u003e on the host system.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003e… (they are synonymous)\u003c/p\u003e","post_number":17,"post_type":1,"updated_at":"2021-06-09T08:34:42.245Z","reply_count":1,"reply_to_post_number":16,"quote_count":1,"incoming_link_count":1,"reads":38,"readers_count":37,"score":32.6,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Oliver Grawert","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"mardy","avatar_template":"/user_avatar/forum.snapcraft.io/mardy/{size}/7599_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":9,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":94026,"name":"Alberto Mardegan","username":"mardy","avatar_template":"/user_avatar/forum.snapcraft.io/mardy/{size}/7599_2.png","created_at":"2021-06-09T09:03:13.971Z","cooked":"\u003cp\u003eOh, I see, I missed that, thanks \u003cimg src=\"https://forum.snapcraft.io/images/emoji/emoji_one/slight_smile.png?v=9\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"\u003e\u003c/p\u003e","post_number":18,"post_type":1,"updated_at":"2021-06-09T09:03:13.971Z","reply_count":0,"reply_to_post_number":17,"quote_count":0,"incoming_link_count":0,"reads":36,"readers_count":35,"score":7.2,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Alberto Mardegan","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"ogra","avatar_template":"/user_avatar/forum.snapcraft.io/ogra/{size}/22_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":10076,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":107065,"name":"Robert P. J. Day","username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","created_at":"2022-03-18T13:25:27.410Z","cooked":"\u003cp\u003esnapcraft test utility seems to suggest that there is an additional valid value for system-usernames:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e@pytest.mark.parametrize(\"username\", [\"snap_daemon\", \"snap_microk8s\"])\ndef test_yaml_valid_system_usernames_long(data, username):\n    data[\"system-usernames\"] = {username: {\"scope\": \"shared\"}}\n    Validator(data).validate()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo is “snap_microk8s” now a valid system username?\u003c/p\u003e","post_number":19,"post_type":1,"updated_at":"2022-03-18T13:25:27.410Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":29,"readers_count":28,"score":10.8,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Robert P. J. Day","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":11710,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":107516,"name":"Kyle Nitzsche","username":"kyleN","avatar_template":"/user_avatar/forum.snapcraft.io/kylen/{size}/229_2.png","created_at":"2022-03-30T13:19:24.096Z","cooked":"\u003cp\u003e\u003ccode\u003esnap_microk8s\u003c/code\u003e doesn’t appear in the microk8s snap rev 3052 now on 1.23/stable, so I suspect this is prep work for future use and that only the microk8s snap would be able to use it. \u003ccode\u003esnap_daemon\u003c/code\u003e has a more generic use case.\u003c/p\u003e","post_number":20,"post_type":1,"updated_at":"2022-03-30T13:19:24.096Z","reply_count":1,"reply_to_post_number":19,"quote_count":0,"incoming_link_count":1,"reads":28,"readers_count":27,"score":15.6,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Kyle Nitzsche","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":52,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":107854,"name":"Alberto Mardegan","username":"mardy","avatar_template":"/user_avatar/forum.snapcraft.io/mardy/{size}/7599_2.png","created_at":"2022-04-07T15:44:43.628Z","cooked":"\u003cp\u003eThat’s correct; for the time being we still lack a way for snaps to add arbitrary usernames, and those few taht we have defined so far are targeted for specific use-cases; that’s why, indeed, only the \u003ccode\u003emicrok8s\u003c/code\u003e snap is allowed to declare the \u003ccode\u003esnap_microk8s\u003c/code\u003e user.\u003c/p\u003e","post_number":21,"post_type":1,"updated_at":"2022-04-07T15:44:43.628Z","reply_count":0,"reply_to_post_number":20,"quote_count":0,"incoming_link_count":0,"reads":26,"readers_count":25,"score":5.2,"yours":false,"topic_id":13386,"topic_slug":"system-usernames","display_username":"Alberto Mardegan","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"kyleN","avatar_template":"/user_avatar/forum.snapcraft.io/kylen/{size}/229_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":10076,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[55599,59520,62048,62052,62060,62082,62083,62748,69814,69820,83367,83369,83383,94021,94022,94026,107065,107516,107854]},"timeline_lookup":[[1,1360],[2,1290],[3,1237],[6,1235],[8,1223],[9,1127],[11,925],[14,737],[17,455],[18,443],[19,434]],"suggested_topics":[{"id":32229,"title":"Library linter","fancy_title":"Library linter","slug":"library-linter","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2022-10-18T17:35:43.980Z","last_posted_at":"2022-10-19T03:00:57.683Z","bumped":true,"bumped_at":"2022-10-19T03:00:57.683Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":3,"views":793,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":3793,"username":"cmatsuoka","name":"Claudio Matsuoka","avatar_template":"/user_avatar/forum.snapcraft.io/cmatsuoka/{size}/9338_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":393,"username":"jamesh","name":"James Henstridge","avatar_template":"/user_avatar/forum.snapcraft.io/jamesh/{size}/3947_2.png"}}]},{"id":31214,"title":"ROS 2 shared memory in snaps","fancy_title":"ROS 2 shared memory in snaps","slug":"ros-2-shared-memory-in-snaps","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-08-09T13:28:52.600Z","last_posted_at":"2022-08-23T09:55:20.580Z","bumped":true,"bumped_at":"2022-08-23T09:55:20.580Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":1,"views":1271,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":11989,"username":"gbeuzeboc","name":"","avatar_template":"/letter_avatar/gbeuzeboc/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":30848,"title":"Snap Tutorials","fancy_title":"Snap Tutorials","slug":"snap-tutorials","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-12T10:04:41.667Z","last_posted_at":"2022-07-12T10:04:41.817Z","bumped":true,"bumped_at":"2023-03-31T17:48:24.106Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1682,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":30905,"title":"Snapcraft documentation","fancy_title":"Snapcraft documentation","slug":"snapcraft-documentation","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-15T11:05:45.374Z","last_posted_at":"2022-07-15T11:05:45.528Z","bumped":true,"bumped_at":"2023-02-17T19:55:21.024Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1532,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":32228,"title":"Classic linter","fancy_title":"Classic linter","slug":"classic-linter","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-10-18T17:22:41.599Z","last_posted_at":"2022-10-19T13:02:49.311Z","bumped":true,"bumped_at":"2022-10-19T13:02:49.311Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":2,"views":920,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":3793,"username":"cmatsuoka","name":"Claudio Matsuoka","avatar_template":"/user_avatar/forum.snapcraft.io/cmatsuoka/{size}/9338_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":393,"username":"jamesh","name":"James Henstridge","avatar_template":"/user_avatar/forum.snapcraft.io/jamesh/{size}/3947_2.png"}}]}],"tags":[],"id":13386,"title":"System usernames","fancy_title":"System usernames","posts_count":19,"created_at":"2019-09-24T21:19:18.138Z","views":7793,"reply_count":12,"like_count":9,"last_posted_at":"2022-04-07T15:44:43.628Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"system-usernames","category_id":15,"word_count":2467,"deleted_at":null,"user_id":21,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_13386","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":21,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"topic_timer":null,"message_bus_last_id":0,"participant_count":9,"show_read_indicator":false,"thumbnails":null,"details":{"notification_level":1,"participants":[{"id":2438,"username":"ijohnson","name":"Ian Johnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png","post_count":4,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":21,"username":"jdstrand","name":"Jamie Strandboge","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","post_count":4,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":10076,"username":"mardy","name":"Alberto Mardegan","avatar_template":"/user_avatar/forum.snapcraft.io/mardy/{size}/7599_2.png","post_count":3,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":2677,"username":"lopezem","name":"Emilio Lopez","avatar_template":"/user_avatar/forum.snapcraft.io/lopezem/{size}/5389_2.png","post_count":2,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":1418,"username":"galgalesh","name":"Merlijn Sebrechts","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png","post_count":2,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":11710,"username":"rpjday","name":"Robert P. J. Day","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":52,"username":"kyleN","name":"Kyle Nitzsche","avatar_template":"/user_avatar/forum.snapcraft.io/kylen/{size}/229_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":259,"username":"cmars","name":"Casey Marshall","avatar_template":"/letter_avatar/cmars/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":9,"username":"ogra","name":"Oliver Grawert","avatar_template":"/user_avatar/forum.snapcraft.io/ogra/{size}/22_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null}],"created_by":{"id":21,"username":"jdstrand","name":"Jamie Strandboge","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"last_poster":{"id":10076,"username":"mardy","name":"Alberto Mardegan","avatar_template":"/user_avatar/forum.snapcraft.io/mardy/{size}/7599_2.png"},"links":[{"url":"https://forum.snapcraft.io/t/multiple-users-and-groups-in-snaps/1461","title":"Multiple users and groups in snaps","internal":true,"attachment":false,"reflection":false,"clicks":56,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/snapcraft-yaml-reference/4276","title":"Snapcraft.yaml reference","internal":true,"attachment":false,"reflection":false,"clicks":16,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://git.launchpad.net/~jdstrand/+git/test-setpriv/tree/","title":"~jdstrand/+git/test-setpriv - [no description]","internal":false,"attachment":false,"reflection":false,"clicks":11,"user_id":21,"domain":"git.launchpad.net","root_domain":"launchpad.net"},{"url":"https://git.launchpad.net/~jdstrand/+git/test-setgroups/tree/","title":"~jdstrand/+git/test-setgroups - [no description]","internal":false,"attachment":false,"reflection":false,"clicks":11,"user_id":21,"domain":"git.launchpad.net","root_domain":"launchpad.net"},{"url":"https://github.com/tianon/gosu","title":"GitHub - tianon/gosu: Simple Go-based setuid+setgid+setgroups+exec","internal":false,"attachment":false,"reflection":false,"clicks":9,"user_id":21,"domain":"github.com","root_domain":"github.com"},{"url":"https://forum.snapcraft.io/t/services-and-daemons/12601","title":"Services and daemons","internal":true,"attachment":false,"reflection":false,"clicks":9,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/can-a-confined-snap-run-as-a-different-uid-and-or-guid/18057/2","title":"Can a confined Snap run as a different uid and or guid?","internal":true,"attachment":false,"reflection":true,"clicks":7,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://github.com/anonymouse64/postgres-snap","title":"GitHub - anonymouse64/postgres-snap: Strictly confined snap of postgres using new system-usernames snapd feature","internal":false,"attachment":false,"reflection":false,"clicks":4,"user_id":2677,"domain":"github.com","root_domain":"github.com"},{"url":"https://snapcraft.io/docs/process-control-interface","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":21,"domain":"snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://github.com/snapcore/snapd/blob/cf7c1792f9fd37694b8cf786deec07ef66b25b27/interfaces/apparmor/template.go#L417-L420","title":"snapd/template.go at cf7c1792f9fd37694b8cf786deec07ef66b25b27 · snapcore/snapd · GitHub","internal":false,"attachment":false,"reflection":false,"clicks":2,"user_id":2438,"domain":"github.com","root_domain":"github.com"},{"url":"https://github.com/systemd/systemd/blob/master/docs/UIDS-GIDS.md","title":"systemd/UIDS-GIDS.md at master · systemd/systemd · GitHub","internal":false,"attachment":false,"reflection":false,"clicks":2,"user_id":21,"domain":"github.com","root_domain":"github.com"},{"url":"https://forum.snapcraft.io/t/multiple-users-and-groups-in-snaps/1461/24","title":"Multiple users and groups in snaps","internal":true,"attachment":false,"reflection":true,"clicks":2,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"}]}}