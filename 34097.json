{"post_stream":{"posts":[{"id":120294,"name":"David Boddie","username":"dboddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png","created_at":"2023-02-27T16:32:26.930Z","cooked":"\u003cp\u003eSome snaps need to have access to system resources outside the scope allowed by\nstrict confinement, and are unable to do this via the available interfaces.\nThese snaps are configured to use classic confinement and will \u003ca href=\"/t/process-for-reviewing-classic-confinement-snaps/1460\"\u003eneed to be reviewed\u003c/a\u003e before publication in the Snap Store.\u003c/p\u003e\n\u003cp\u003eThis guide shows how to enable classic confinement for a snap built with the\n\u003ca href=\"/t/8622\"\u003emake plugin\u003c/a\u003e. The example project used in this guide can be found in \u003ca href=\"https://github.com/snapcraft-doc-samples-unofficial/makefile-lib-example\"\u003ethis repository\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eChange the confinement to classic\u003c/h2\u003e\n\u003cp\u003eStarting with an existing \u003ccode\u003esnapcraft.yaml\u003c/code\u003e file, change the \u003ccode\u003econfinement\u003c/code\u003e setting to \u003ccode\u003eclassic\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003econfinement: classic\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will cause the snap to be built in a way that gives it access to system resources.\u003c/p\u003e\n\u003ch2\u003eUse linters to identify problems\u003c/h2\u003e\n\u003cp\u003eSnapcraft uses \u003ca href=\"/t/snapcraft-linters\"\u003elinters\u003c/a\u003e to check for issues during builds.\nLinters can only be specified in snaps that use the \u003ca href=\"/t/base-snaps\"\u003ecore22 base\u003c/a\u003e. Warnings are still reported for snaps that use older bases.\u003c/p\u003e\n\u003cp\u003eRun Snapcraft to build the snap. This may produce warnings like the following:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eLint warnings:\n- classic: bin/example-make-lib: ELF interpreter should be set to '/snap/core22/current/lib64/ld-linux-x86-64.so.2'.\n- classic: bin/example-make-lib: ELF rpath should be set to '/snap/core22/current/lib/x86_64-linux-gnu'.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf there are many warnings about libraries you can disable the library linter so that only classic linter warnings are shown. See the \u003ca href=\"/t/snapcraft-linters\"\u003elinters\u003c/a\u003e documentation for details.\u003c/p\u003e\n\u003ch2\u003eFix linter warnings by patching ELF binaries\u003c/h2\u003e\n\u003cp\u003eThe easiest way to handle warnings about the ELF interpreter and rpath is to let Snapcraft automatically patch the binaries using \u003ccode\u003epatchelf\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThis is enabled by default for \u003ccode\u003ecore20\u003c/code\u003e classic snaps, and can also be enabled for \u003ccode\u003ecore22\u003c/code\u003e classic snaps if you are using Snapcraft 7.3 or a version from the edge channel. Pass the \u003ccode\u003eenable-patchelf\u003c/code\u003e build attribute to the \u003ccode\u003emake\u003c/code\u003e plugin:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e    plugin: make\n    build-attributes:\n     - enable-patchelf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis can be removed when automatic patching is enabled for \u003ccode\u003ecore22\u003c/code\u003e classic snaps in stable releases.\u003c/p\u003e\n\u003ch2\u003eFix linter warnings in the Makefile\u003c/h2\u003e\n\u003cp\u003eIn this example, the warnings about the ELF interpreter and rpath can alternatively be handled by adding options to the linker in the appropriate build rule of the Makefile:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-Wl,-dynamic-linker=/snap/core22/current/lib64/ld-linux-x86-64.so.2\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-Wl,-rpath=/snap/core22/current/lib/x86_64-linux-gnu\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf the \u003ccode\u003eLDFLAGS\u003c/code\u003e environment variable is used in the Makefile, the \u003ccode\u003esnapcraft.yaml\u003c/code\u003e file can be updated to pass these options to the \u003ccode\u003emake\u003c/code\u003e plugin, like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e    plugin: make\n    make-parameters:\n      - LDFLAGS=\"-Wl,-dynamic-linker=/snap/core22/current/lib64/ld-linux-x86-64.so.2 -Wl,-rpath=/snap/core22/current/lib/x86_64-linux-gnu\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will only be useful for projects where the \u003ccode\u003eLDFLAGS\u003c/code\u003e variable can be used to influence the build process.\u003c/p\u003e\n\u003ch2\u003eRebuild the snap\u003c/h2\u003e\n\u003cp\u003eRun Snapcraft again to rebuild the snap, consulting the \u003ca href=\"/t/classic-linter\"\u003eClassic linter\u003c/a\u003e documentation to resolve further issues.\u003c/p\u003e\n\u003cp\u003eSee also \u003ca href=\"https://snapcraft.io/blog/the-new-classic-confinement-in-snaps-even-the-classics-need-a-change\"\u003ethis article \u003c/a\u003e for an overview of the classic linter and a discussion of the issues involved in building snaps for classic confinement.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2023-04-19T11:17:33.984Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":62,"reads":12,"readers_count":11,"score":302.4,"yours":false,"topic_id":34097,"topic_slug":"set-up-classic-confinement-for-a-makefile-project","display_username":"David Boddie","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":7,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/process-for-reviewing-classic-confinement-snaps/1460","internal":true,"reflection":false,"title":"Process for reviewing classic confinement snaps","clicks":1},{"url":"https://github.com/snapcraft-doc-samples-unofficial/makefile-lib-example","internal":false,"reflection":false,"clicks":0},{"url":"https://forum.snapcraft.io/t/snapcraft-linters/32211","internal":true,"reflection":false,"title":"Snapcraft linters","clicks":0},{"url":"https://forum.snapcraft.io/t/the-make-plugin/8622","internal":true,"reflection":false,"title":"The make plugin","clicks":0},{"url":"https://snapcraft.io/blog/the-new-classic-confinement-in-snaps-even-the-classics-need-a-change","internal":false,"reflection":false,"title":"The new classic confinement in snaps – Even the classics need a change | Snapcraft","clicks":0},{"url":"https://forum.snapcraft.io/t/classic-linter/32228","internal":true,"reflection":false,"title":"Classic linter","clicks":0},{"url":"https://forum.snapcraft.io/t/base-snaps/11198","internal":true,"reflection":false,"title":"Base snaps","clicks":0},{"url":"https://forum.snapcraft.io/t/how-to-guides-for-classic-confinement/34416","internal":true,"reflection":true,"title":"How to guides for classic confinement","clicks":0},{"url":"https://forum.snapcraft.io/t/snap-documentation/11127","internal":true,"reflection":true,"title":"Snap documentation","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":14015,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":"Added a link to the make plugin.","can_view_edit_history":true,"wiki":true,"last_wiki_edit":"2023-04-19T11:17:34.005Z","can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":120295,"name":"David Boddie","username":"dboddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png","created_at":"2023-02-27T16:34:00.750Z","cooked":"\u003cp\u003eSome notes as I review what I’ve written:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eI guess the links need to be in-forum links rather than direct-to-documentation links.\u003c/li\u003e\n\u003c/ul\u003e","post_number":2,"post_type":1,"updated_at":"2023-02-27T16:34:00.750Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":8,"readers_count":7,"score":1.6,"yours":false,"topic_id":34097,"topic_slug":"set-up-classic-confinement-for-a-makefile-project","display_username":"David Boddie","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":14015,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[120294,120295]},"timeline_lookup":[[1,108]],"suggested_topics":[{"id":34416,"title":"How to guides for classic confinement","fancy_title":"How to guides for classic confinement","slug":"how-to-guides-for-classic-confinement","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2023-03-21T09:34:37.128Z","last_posted_at":"2023-03-21T09:50:37.844Z","bumped":true,"bumped_at":"2023-03-21T09:50:37.844Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":["how-to"],"like_count":0,"views":462,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":35563,"title":"The WebkitGTK Problem","fancy_title":"The WebkitGTK Problem","slug":"the-webkitgtk-problem","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2023-06-10T19:28:37.898Z","last_posted_at":"2023-06-10T19:28:38.095Z","bumped":true,"bumped_at":"2023-06-13T06:29:04.736Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":1,"views":55,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":13970,"username":"soumyaDghosh","name":"Soumyadeep Ghosh","avatar_template":"/letter_avatar/soumyadghosh/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}}]},{"id":32986,"title":"Snapcraft installation and setup","fancy_title":"Snapcraft installation and setup","slug":"snapcraft-installation-and-setup","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2022-12-07T12:49:10.746Z","last_posted_at":"2022-12-15T10:43:52.370Z","bumped":true,"bumped_at":"2022-12-07T12:49:10.898Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":820,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":32197,"title":"Core 22 QT 5 enabled snaps","fancy_title":"Core 22 QT 5 enabled snaps","slug":"core-22-qt-5-enabled-snaps","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-10-16T21:41:22.367Z","last_posted_at":"2022-10-16T21:41:22.512Z","bumped":true,"bumped_at":"2022-10-16T21:41:22.512Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":235,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":13367,"username":"coalman321","name":"","avatar_template":"/letter_avatar/coalman321/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}}]},{"id":31668,"title":"The posix-mq interface","fancy_title":"The posix-mq interface","slug":"the-posix-mq-interface","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-09-08T12:00:35.327Z","last_posted_at":"2022-09-08T12:00:35.467Z","bumped":true,"bumped_at":"2023-04-14T09:29:21.981Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":889,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]}],"tags":["how-to"],"id":34097,"title":"Set up classic confinement for a Makefile project","fancy_title":"Set up classic confinement for a Makefile project","posts_count":2,"created_at":"2023-02-27T16:32:26.768Z","views":762,"reply_count":0,"like_count":0,"last_posted_at":"2023-02-27T16:34:00.750Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"set-up-classic-confinement-for-a-makefile-project","category_id":15,"word_count":572,"deleted_at":null,"user_id":14015,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_34097","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":2,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"details":{"notification_level":1,"participants":[{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png","post_count":2,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null}],"created_by":{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png"},"last_poster":{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png"},"links":[{"url":"https://forum.snapcraft.io/t/process-for-reviewing-classic-confinement-snaps/1460","title":"Process for reviewing classic confinement snaps","internal":true,"attachment":false,"reflection":false,"clicks":1,"user_id":14015,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"}]}}