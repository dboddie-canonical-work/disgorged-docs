{"post_stream":{"posts":[{"id":39623,"name":"Graham Morrison","username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","created_at":"2018-12-13T13:04:36.642Z","cooked":"\u003cp\u003eA \u003cem\u003efileset\u003c/em\u003e is used within \u003ca href=\"/t/the-snapcraft-format/8337\"\u003esnapcraft.yaml\u003c/a\u003e to represent a group of files, or a single file, when \u003ca href=\"/t/snapcraft-overview/8940\"\u003ecreating a snap\u003c/a\u003e.\u003c/p\u003e\n\u003cdiv class=\"p-notification--caution\"\u003e\n\u003cp class=\"p-notification__response\"\u003e\n\u003cspan class=\"p-notification__status\"\u003e\nSnapcraft 7 and core22: \u003c/span\u003e\nFilesets do not currently work  when building snaps with \u003ccode\u003ecore22\u003c/code\u003e \u003ca href=\"/t/base-snaps/11198\"\u003ebase snaps\u003c/a\u003e and Snapcraft 7.x .\u003c/p\u003e\n\u003c/div\u003e\n\u003cp\u003eThey’re useful when moving files into the \u003cem\u003estage\u003c/em\u003e and \u003cem\u003eprime\u003c/em\u003e areas of the build process (see \u003ca href=\"/t/parts-lifecycle/12231\"\u003eSnapcraft lifecycle\u003c/a\u003e for more details) as they can be referenced individually, rather than always having to construct a list of filenames.\u003c/p\u003e\n\u003cp\u003eA fileset is implemented as a YAML map between the fileset name (the key) and a list of corresponding filenames for each fileset. This list can be built from any of the following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eindividual files, eg. \u003ccode\u003e[ bin/dnsmasq ]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003esubdirectory paths, eg. \u003ccode\u003e[ etc ]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003ewildcard globs, eg. \u003ccode\u003e[ usr/* ]\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eglobstar globs, eg. \u003ccode\u003e[ lib/**/*.so* ]\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe \u003ccode\u003e*\u003c/code\u003e (asterisk) wildcard glob returns all the files in that path. Conversely, adding an initial \u003ccode\u003e-\u003c/code\u003e (dash) will exclude the files in that path. For example, you could add \u003ccode\u003eusr/local/*\u003c/code\u003e then remove \u003ccode\u003eusr/local/man/*\u003c/code\u003e with the following:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003efilesets:\n   allbutman: [ usr/local/*, -usr/local/man/* ]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFilenames are relative to the part install directory, eg. \u003ccode\u003eparts/\u0026lt;part-name\u0026gt;/install\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eIf you have used the \u003ca href=\"/t/snapcraft-parts-metadata/8336\"\u003eorganize\u003c/a\u003e keyword to rename files from your snapcraft.yaml part, your fileset will be built from filenames \u003cem\u003eafter\u003c/em\u003e  they’re renamed.\u003c/p\u003e\n\u003ch2\u003eConflicting rules example\u003c/h2\u003e\n\u003cp\u003eSnapcraft \u003cem\u003ewill\u003c/em\u003e attempt to aggregate conflicting rules from different filesets. For example, take the following directory and file structure:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-bash\"\u003eadir\n├── adirthat\n├── adirthis\n└── bdir\n    ├── bdirthat\n    └── bdirthis\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe following fileset definition will not stage \u003ccode\u003eadir/bdir/*\u003c/code\u003e despite its specific inclusion under \u003ccode\u003eadir/*\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003efilesets:\n  exclude-dir: [ -adir/bdir/* ]\n  include-dir: [ adir/* ]\nstage:\n  - $include-dir\n  - $exclude-dir\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn the above example, using the excluding syntax \u003ccode\u003eadir/bdir\u003c/code\u003e instead of  \u003ccode\u003eadir/bdir/*\u003c/code\u003e would exclude both the \u003ccode\u003ebdir\u003c/code\u003e directory \u003cstrong\u003eand\u003c/strong\u003e its contents, rather than excluding only the contents, retaining the empty \u003ccode\u003ebdir\u003c/code\u003e itself.\u003c/p\u003e\n\u003cp\u003eThis is how the above will be staged within the snap:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eadir\n├── adirthat\n├── adirthis\n└── bdir\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf, however, we remove the \u003ccode\u003eexclude-dir: [ -adir/bdir/* ]\u003c/code\u003e fileset definition, all the files and directories beneath \u003cem\u003eadir\u003c/em\u003e will be staged in the snap:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eadir\n├── adirthat\n├── adirthis\n└── bdir\n    ├── bdirthat\n    └── bdirthis\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eRelevant Snapcraft source code\u003c/h2\u003e\n\u003cp\u003eCheck out \u003ca href=\"https://github.com/snapcore/snapcraft/blob/7b848f76debfa2cb020308c5b908eb570d06c0b9/snapcraft_legacy/internal/pluginhandler/__init__.py#L1306-L1355\"\u003ethe _organize_filesets function in snapcraft_legacy/internal/pluginhandler/\u003cstrong\u003einit\u003c/strong\u003e.py\u003c/a\u003e\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2022-11-02T11:21:15.231Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":289,"reads":62,"readers_count":61,"score":1474.4,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Graham Morrison","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":16,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/snapcraft-parts-metadata/8336","internal":true,"reflection":false,"title":"Snapcraft parts metadata","clicks":6},{"url":"https://forum.snapcraft.io/t/parts-lifecycle/12231","internal":true,"reflection":false,"title":"Parts lifecycle","clicks":3},{"url":"https://forum.snapcraft.io/t/base-snaps/11198","internal":true,"reflection":false,"title":"Base snaps","clicks":1},{"url":"https://forum.snapcraft.io/t/snapcraft-overview/8940","internal":true,"reflection":false,"title":"Snapcraft overview","clicks":0},{"url":"https://github.com/snapcore/snapcraft/blob/7b848f76debfa2cb020308c5b908eb570d06c0b9/snapcraft_legacy/internal/pluginhandler/__init__.py#L1306-L1355","internal":false,"reflection":false,"clicks":0},{"url":"https://forum.snapcraft.io/t/the-snapcraft-yaml-schema/8337","internal":true,"reflection":false,"title":"The snapcraft.yaml schema","clicks":0},{"url":"https://forum.snapcraft.io/t/globstar-syntax-not-working/9490/2","internal":true,"reflection":true,"title":"Globstar syntax not working?","clicks":1},{"url":"https://forum.snapcraft.io/t/documentation-roadmap/8763","internal":true,"reflection":true,"title":"Documentation roadmap","clicks":0},{"url":"https://forum.snapcraft.io/t/snapcraft-yaml-reference/4276","internal":true,"reflection":true,"title":"Snapcraft.yaml reference","clicks":0},{"url":"https://forum.snapcraft.io/t/snap-documentation/11127","internal":true,"reflection":true,"title":"Snap documentation","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":true,"admin":true,"staff":true,"user_id":2772,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":true,"last_wiki_edit":"2022-11-02T11:21:15.248Z","can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":40204,"name":"林博仁(Buo-ren, Lin)","username":"Lin-Buo-Ren","avatar_template":"/user_avatar/forum.snapcraft.io/lin-buo-ren/{size}/4612_2.png","created_at":"2018-12-25T03:51:40.364Z","cooked":"\u003cp\u003eNote that Snapcraft doesn’t aggregate conflicting rules from different filesets, for example, the following recipe \u003cem\u003ewill still stage \u003ccode\u003eusr/share/alsa\u003c/code\u003e\u003c/em\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e    filesets:\n      exclude-alsa-files:\n      - -usr/share/alsa/*\n      include-usr-files:\n      - usr/*\n    stage:\n    - $exclude-alsa-files\n    - $include-usr-files\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhile this one works:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e    filesets:\n      include-usr-files:\n      - usr/*\n      - -usr/share/alsa/*\n    stage:\n    - $include-usr-files\n\u003c/code\u003e\u003c/pre\u003e","post_number":2,"post_type":1,"updated_at":"2018-12-25T03:51:40.364Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":44,"readers_count":43,"score":68.8,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"林博仁(Buo-ren, Lin)","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":1417,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":40706,"name":"Graham Morrison","username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","created_at":"2019-01-07T12:04:13.156Z","cooked":"\u003caside class=\"quote no-group quote-modified\" data-username=\"Lin-Buo-Ren\" data-post=\"2\" data-topic=\"8973\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/lin-buo-ren/40/4612_2.png\" class=\"avatar\"\u003e Lin-Buo-Ren:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNote that Snapcraft doesn’t aggregate conflicting rules from different filesets…\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eThanks for mentioning this - it’s an important point which I’ve added to the main doc.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2019-01-07T12:04:13.156Z","reply_count":0,"reply_to_post_number":2,"quote_count":1,"incoming_link_count":1,"reads":37,"readers_count":36,"score":27.4,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Graham Morrison","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":true,"admin":true,"staff":true,"user_id":2772,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":105442,"name":"Robert P. J. Day","username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","created_at":"2022-02-08T23:32:57.121Z","cooked":"\u003cp\u003eAre you sure about that first example in “Conflicting rules”? I tried this, and it seems like the excluded files really are excluded.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2022-02-08T23:32:57.121Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":17,"readers_count":16,"score":13.4,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Robert P. J. Day","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":11710,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":105462,"name":"Graham Morrison","username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","created_at":"2022-02-09T11:21:55.117Z","cooked":"\u003cp\u003eYou’re right about the first example! I’ve just tried this myself, and the excluded files were excluded for me too.\u003c/p\u003e\n\u003cp\u003eI’m not sure if this changed, or was wrong initially (I did test it when writing the doc, but that was some time ago). Either way, I’ll update the text. Thanks for finding this and for letting us know. \u003cstrong\u003eEdit: now updated\u003c/strong\u003e\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2022-02-09T11:40:38.448Z","reply_count":0,"reply_to_post_number":4,"quote_count":0,"incoming_link_count":0,"reads":18,"readers_count":17,"score":3.6,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Graham Morrison","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"},"bookmarked":false,"actions_summary":[],"moderator":true,"admin":true,"staff":true,"user_id":2772,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":105464,"name":"Robert P. J. Day","username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","created_at":"2022-02-09T11:45:07.422Z","cooked":"\u003cp\u003eI might point out that there is a difference with exclusion if you exclude “dir” versus excluding “dir/*”; the former excludes the entire directory, while the latter excludes the \u003cem\u003econtents\u003c/em\u003e of the directory, while retaining the empty directory itself, the lesson being (I think) that it would seem to be relatively uncommon to want to explicitly exclude “dir/*” unless you’re doing something unusual where you really want to keep that empty directory.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2022-02-09T11:45:58.785Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":18,"readers_count":17,"score":8.6,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Robert P. J. Day","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":11710,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":105465,"name":"Graham Morrison","username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","created_at":"2022-02-09T11:54:01.654Z","cooked":"\u003cp\u003eThanks for this. I’ve added your suggestion as a note rather than set the example to only use\u003ccode\u003edir\u003c/code\u003e as this hopefully provides a little extra insight into Linux wildcard globs.\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2022-02-09T13:48:54.474Z","reply_count":0,"reply_to_post_number":6,"quote_count":0,"incoming_link_count":0,"reads":20,"readers_count":19,"score":4.0,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Graham Morrison","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"},"bookmarked":false,"actions_summary":[],"moderator":true,"admin":true,"staff":true,"user_id":2772,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":105473,"name":"Robert P. J. Day","username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","created_at":"2022-02-09T14:35:51.887Z","cooked":"\u003cp\u003eOne apparent problem with this discussion of filesets is that it seems to assume that the reader is already familiar with the process of inclusion or inclusion using stage: and prime:, but I don’t see where that’s done. There’s that early link to “Snapcraft lifecycle”, but there’s no real explanation there that I can see.\u003c/p\u003e\n\u003cp\u003ePerhaps the right approach is to expand the scope of this page to cover that, with filesets as the concluding section.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2022-02-09T14:35:51.887Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":19,"readers_count":18,"score":18.8,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Robert P. J. Day","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":11710,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":105474,"name":"Graham Morrison","username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","created_at":"2022-02-09T16:13:18.846Z","cooked":"\u003cp\u003eYeah, that’s a good point. It’s probably worth a separate document on where files are included and how they’re staged and primed. The whole process is still very opaque to the average snap builder. I’ll give it some thought and try to write something.\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2022-02-09T16:13:18.846Z","reply_count":1,"reply_to_post_number":8,"quote_count":0,"incoming_link_count":0,"reads":19,"readers_count":18,"score":8.8,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Graham Morrison","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"},"bookmarked":false,"actions_summary":[],"moderator":true,"admin":true,"staff":true,"user_id":2772,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":105475,"name":"Robert P. J. Day","username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","created_at":"2022-02-09T16:16:57.434Z","cooked":"\u003cp\u003eI did extensive testing and have confirmed how inclusion and exclusion works, especially if you try to combine them.\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2022-02-09T16:16:57.434Z","reply_count":0,"reply_to_post_number":9,"quote_count":0,"incoming_link_count":0,"reads":21,"readers_count":20,"score":4.2,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Robert P. J. Day","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":11710,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":107411,"name":"Robert P. J. Day","username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","created_at":"2022-03-26T12:54:34.262Z","cooked":"\u003cp\u003eUpon further testing, I’m having trouble seeing the benefit of filesets as they seem to be more trouble than they’re worth in a number of ways. (I am willing to be corrected on any of this.)\u003c/p\u003e\n\u003cp\u003eFirst, since they’re defined on a per-part basis, it’s not like you can define a really useful, sophisticated fileset, then use it across multiple parts. Or can you? If you could, that would be at least one redeeming feature, but that doesn’t seem possible.\u003c/p\u003e\n\u003cp\u003eNext, this page promotes the power of the fileset’s “globstar” globbing, but it seems like you have that same ability in the regular stage: or prime: sections already, so you certainly don’t need to resort to filesets to use it. (As an aside, if you truly need to get that carried away with globstar-level globbing, it would seem simpler to just use a step override script and deal with it that way.)\u003c/p\u003e\n\u003cp\u003eNext, it seems odd that a fileset is defined as using either inclusion or exclusion right in the definition of the fileset, which makes it less than reusable. For instance, if a fileset simply defined a collection of files, and its invocation got to select whether it represented inclusion or exclusion, you could do something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e  stage:\n    - $fileset\n  prime:\n     - -$fileset\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhich would represent that you want to selectively stage some stuff (perhaps for the benefit of other parts), but you would then subsequently exclude it from being primed. But that’s not how it works, of course. In fact, if you put the exclusion “-” in front of the fileset reference as above, snapcraft quietly ignores the entire entry and the fileset reference has no effect (which is definitely non-intuitive).\u003c/p\u003e\n\u003cp\u003eFinally, the only examples I’ve seen so far that attempt to reuse a fileset definition look like this (snapcraft/tests/spread/plugins/v1/plainbox/snaps/checkbox/snap/snapcraft.yaml):\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e filesets:\n     wrapper: [bin/checkbox-cli-wrapper]\n stage: [$wrapper]\n prime: [$wrapper]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhich seems kind of redundant since, if you’ve staged just that one file, would not the default be to prime it? The above seems like a lot of work to say you just want to stage (and prime) that file.\u003c/p\u003e\n\u003cp\u003eHaving said all that, I can envision one reasonable use case, as follows:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efilesets:\n  stage_only: [ included files ]\n  stage_AND_prime: [ different included files ]\nstage:\n  - $stage_only\n  - $stage_AND_prime\nprime:\n  - $stage_AND_prime\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSo, sure, this is a useful way to selectively stage some stuff, then further selectively prime a \u003cem\u003esubset\u003c/em\u003e of what was staged. But beyond that, this sure seems like an awkward feature.\u003c/p\u003e\n\u003cp\u003eThoughts?\u003c/p\u003e\n\u003cp\u003eOh, wait, I might have misunderstood a small but critical point, will recheck, but most of the above still holds.\u003c/p\u003e","post_number":11,"post_type":1,"updated_at":"2022-03-26T13:01:41.249Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":2,"reads":16,"readers_count":15,"score":28.2,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Robert P. J. Day","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":11710,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":113868,"name":"Robert P. J. Day","username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","created_at":"2022-09-09T07:29:23.758Z","cooked":"\u003cp\u003eReportedly, filesets have been dropped from Snapcraft 7, and while they may be coming back in a different form, they’re not there now. At least as I see it. Perhaps this should be noted.\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2022-09-09T07:29:23.758Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":10,"readers_count":9,"score":7.0,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Robert P. J. Day","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":11710,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":113874,"name":"Graham Morrison","username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","created_at":"2022-09-09T10:56:26.290Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"rpjday\" data-post=\"12\" data-topic=\"8973\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/rpjday/40/8457_2.png\" class=\"avatar\"\u003e rpjday:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReportedly, filesets have been dropped from Snapcraft 7,\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eThanks for bringing this to my attention. I just ran a few of my own tests and while it still works with Snapcraft 7 and \u003ccode\u003ecore20\u003c/code\u003e, it does not work with \u003ccode\u003ecore22\u003c/code\u003e. I’ll add a note to mention this.\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2022-09-09T10:56:26.290Z","reply_count":1,"reply_to_post_number":12,"quote_count":1,"incoming_link_count":0,"reads":10,"readers_count":9,"score":7.0,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Graham Morrison","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":true,"staff":true,"user_id":2772,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":113876,"name":"Robert P. J. Day","username":"rpjday","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","created_at":"2022-09-09T11:35:48.000Z","cooked":"\u003cp\u003eFilesets were always badly designed – the idea that you needed to define them as inclusive or exclusive really reduced their value.\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2022-09-09T11:36:55.358Z","reply_count":0,"reply_to_post_number":13,"quote_count":0,"incoming_link_count":1,"reads":10,"readers_count":9,"score":7.0,"yours":false,"topic_id":8973,"topic_slug":"snapcraft-filesets","display_username":"Robert P. J. Day","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":11710,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"via_email":true,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[39623,40204,40706,105442,105462,105464,105465,105473,105474,105475,107411,113868,113874,113876]},"timeline_lookup":[[1,1646],[2,1634],[3,1621],[4,492],[8,491],[11,447],[12,280]],"suggested_topics":[{"id":30858,"title":"Snap Explanation guides","fancy_title":"Snap Explanation guides","slug":"snap-explanation-guides","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2022-07-12T15:01:07.909Z","last_posted_at":"2023-05-15T14:55:39.980Z","bumped":true,"bumped_at":"2023-05-15T14:55:39.980Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1373,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":11710,"username":"rpjday","name":"Robert P. J. Day","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"}}]},{"id":32211,"title":"Snapcraft linters","fancy_title":"Snapcraft linters","slug":"snapcraft-linters","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-10-17T20:12:23.427Z","last_posted_at":"2023-05-15T13:21:11.198Z","bumped":true,"bumped_at":"2023-05-15T13:21:11.198Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":4,"views":1229,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":3793,"username":"cmatsuoka","name":"Claudio Matsuoka","avatar_template":"/user_avatar/forum.snapcraft.io/cmatsuoka/{size}/9338_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1418,"username":"galgalesh","name":"Merlijn Sebrechts","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":4363,"username":"xnox","name":"Dimitri John Ledkov","avatar_template":"/user_avatar/forum.snapcraft.io/xnox/{size}/4776_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":393,"username":"jamesh","name":"James Henstridge","avatar_template":"/user_avatar/forum.snapcraft.io/jamesh/{size}/3947_2.png"}}]},{"id":32908,"title":"The pwm-control interface","fancy_title":"The pwm-control interface","slug":"the-pwm-control-interface","posts_count":8,"reply_count":6,"highest_post_number":9,"image_url":null,"created_at":"2022-11-30T08:57:34.695Z","last_posted_at":"2023-03-30T09:37:54.031Z","bumped":true,"bumped_at":"2023-03-30T09:37:54.031Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":3,"views":552,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":8707,"username":"zyga","name":"Zygmunt Krynicki","avatar_template":"/user_avatar/forum.snapcraft.io/zyga/{size}/4376_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":11710,"username":"rpjday","name":"Robert P. J. Day","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"}}]},{"id":33078,"title":"Build and publishing example","fancy_title":"Build and publishing example","slug":"build-and-publishing-example","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-12-13T13:17:46.677Z","last_posted_at":"2023-05-31T16:11:13.715Z","bumped":true,"bumped_at":"2023-05-31T16:11:13.715Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":1,"views":728,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":14652,"username":"jh-slack","name":"Jade Ho","avatar_template":"/letter_avatar/jh-slack/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}}]},{"id":34730,"title":".NET apps","fancy_title":".NET apps","slug":"net-apps","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2023-04-13T17:19:06.288Z","last_posted_at":"2023-05-29T06:08:55.544Z","bumped":true,"bumped_at":"2023-05-29T06:08:55.544Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":3,"views":300,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":14372,"username":"mateus-morais","name":"Mateus Rodrigues de Morais","avatar_template":"/user_avatar/forum.snapcraft.io/mateus-morais/{size}/9752_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":14625,"username":"vvavrychuk","name":"Vasyl Vavrychuk","avatar_template":"/user_avatar/forum.snapcraft.io/vvavrychuk/{size}/9864_2.png"}}]}],"tags":[],"id":8973,"title":"Snapcraft filesets","fancy_title":"Snapcraft filesets","posts_count":14,"created_at":"2018-12-13T13:04:36.331Z","views":6702,"reply_count":7,"like_count":4,"last_posted_at":"2022-09-09T11:35:48.000Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"snapcraft-filesets","category_id":15,"word_count":1408,"deleted_at":null,"user_id":2772,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_8973","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":14,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"topic_timer":null,"message_bus_last_id":0,"participant_count":3,"show_read_indicator":false,"thumbnails":null,"details":{"notification_level":1,"participants":[{"id":11710,"username":"rpjday","name":"Robert P. J. Day","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png","post_count":7,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","post_count":6,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":1417,"username":"Lin-Buo-Ren","name":"林博仁(Buo-ren, Lin)","avatar_template":"/user_avatar/forum.snapcraft.io/lin-buo-ren/{size}/4612_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null}],"created_by":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"},"last_poster":{"id":11710,"username":"rpjday","name":"Robert P. J. Day","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"},"links":[{"url":"https://forum.snapcraft.io/t/snapcraft-parts-metadata/8336","title":"Snapcraft parts metadata","internal":true,"attachment":false,"reflection":false,"clicks":6,"user_id":2772,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/parts-lifecycle/12231","title":"Parts lifecycle","internal":true,"attachment":false,"reflection":false,"clicks":3,"user_id":2772,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/base-snaps/11198","title":"Base snaps","internal":true,"attachment":false,"reflection":false,"clicks":1,"user_id":2772,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/globstar-syntax-not-working/9490/2","title":"Globstar syntax not working?","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":3,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"}]}}