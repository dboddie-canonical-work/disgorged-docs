{"post_stream":{"posts":[{"id":120297,"name":"David Boddie","username":"dboddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png","created_at":"2023-02-27T17:10:47.822Z","cooked":"\u003cp\u003eSome snaps need to have access to system resources outside the scope allowed by strict confinement, and are unable to do this via the available interfaces. These snaps are configured to use classic confinement and will \u003ca href=\"/t/process-for-reviewing-classic-confinement-snaps/1460\"\u003eneed to be reviewed\u003c/a\u003e before publication in the Snap Store.\u003c/p\u003e\n\u003cp\u003eThis guide shows how to enable classic confinement for a snap built with the autotools plugin. The example project used in this guide can be found in \u003ca href=\"https://github.com/snapcraft-doc-samples-unofficial/autotools-classic-example\"\u003ethis repository\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eChange the confinement to classic\u003c/h2\u003e\n\u003cp\u003eStarting with an existing snapcraft.yaml file, change the \u003ccode\u003econfinement\u003c/code\u003e setting to \u003ccode\u003eclassic\u003c/code\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003econfinement: classic\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will cause the snap to be built in a way that gives it access to system resources.\u003c/p\u003e\n\u003ch2\u003eUse linters to identify problems\u003c/h2\u003e\n\u003cp\u003eSnapcraft uses \u003ca href=\"/t/snapcraft-linters\"\u003elinters\u003c/a\u003e to check for issues during builds.\nLinters can only be specified in snaps that use the \u003ca href=\"/t/base-snaps\"\u003ecore22 base\u003c/a\u003e. Warnings are still reported for snaps that use older bases.\u003c/p\u003e\n\u003cp\u003eRun Snapcraft to build the snap. This may produce warnings like the following:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eLint warnings:\n - classic: usr/bin/autotools-classic-example: ELF interpreter should be set to '/snap/core22/current/lib64/ld-linux-x86-64.so.2'.\n - classic: usr/bin/autotools-classic-example: ELF rpath should be set to '/snap/core22/current/lib/x86_64-linux-gnu'.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf there are many warnings about libraries you can disable the library linter so that only classic linter warnings are shown. See the \u003ca href=\"/t/snapcraft-linters\"\u003elinters\u003c/a\u003e documentation for details.\u003c/p\u003e\n\u003ch2\u003eFix linter warnings by patching ELF binaries\u003c/h2\u003e\n\u003cp\u003eThe easiest way to handle warnings about the ELF interpreter and rpath is to let Snapcraft automatically patch the binaries using \u003ccode\u003epatchelf\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThis is enabled by default for \u003ccode\u003ecore20\u003c/code\u003e classic snaps, and can also be enabled for \u003ccode\u003ecore22\u003c/code\u003e classic snaps if you are using Snapcraft 7.3 or a version from the edge channel. Pass the \u003ccode\u003eenable-patchelf\u003c/code\u003e build attribute to the plugin:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e    plugin: autotools\n    build-attributes:\n     - enable-patchelf\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis can be removed when automatic patching is enabled for \u003ccode\u003ecore22\u003c/code\u003e classic snaps in stable releases.\u003c/p\u003e\n\u003ch2\u003eFix linter warnings with linker flags\u003c/h2\u003e\n\u003cp\u003eIn this example, the warnings about the ELF interpreter and rpath can be handled by adding options to the linker:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e-Wl,-dynamic-linker=/snap/core22/current/lib64/ld-linux-x86-64.so.2\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e-Wl,-rpath=/snap/core22/current/lib/x86_64-linux-gnu\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf the \u003ccode\u003eLDFLAGS\u003c/code\u003e environment variable is used by the project, the snapcraft.yaml file can be updated to pass these options to the \u003ccode\u003eautotools\u003c/code\u003e plugin, using the \u003ccode\u003eautotools-configure-parameters\u003c/code\u003e keyword for projects using the \u003ccode\u003ecore20\u003c/code\u003e base or later:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003e    plugin: autotools\n    source: .\n    autotools-configure-parameters:\n     - LDFLAGS=\"-Wl,-dynamic-linker=/snap/core22/current/lib64/ld-linux-x86-64.so.2\n                -Wl,-rpath=/snap/core22/current/lib/x86_64-linux-gnu\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will only be useful for projects where the \u003ccode\u003eLDFLAGS\u003c/code\u003e variable can be used to influence the build process.\u003c/p\u003e\n\u003ch2\u003eRebuild the snap\u003c/h2\u003e\n\u003cp\u003eRun Snapcraft again to rebuild the snap, consulting the \u003ca href=\"/t/classic-linter\"\u003eClassic linter\u003c/a\u003e documentation to resolve further issues.\u003c/p\u003e\n\u003cp\u003eSee also \u003ca href=\"https://snapcraft.io/blog/the-new-classic-confinement-in-snaps-even-the-classics-need-a-change\"\u003ethis article \u003c/a\u003e for an overview of the classic linter and a discussion of the issues involved in building snaps for classic confinement.\u003c/p\u003e","post_number":1,"post_type":1,"updated_at":"2023-03-22T10:26:26.613Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":62,"reads":15,"readers_count":14,"score":318.0,"yours":false,"topic_id":34099,"topic_slug":"set-up-classic-confinement-for-an-autotools-project","display_username":"David Boddie","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":8,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/snapcraft-doc-samples-unofficial/autotools-classic-example","internal":false,"reflection":false,"clicks":1},{"url":"https://forum.snapcraft.io/t/process-for-reviewing-classic-confinement-snaps/1460","internal":true,"reflection":false,"title":"Process for reviewing classic confinement snaps","clicks":0},{"url":"https://snapcraft.io/blog/the-new-classic-confinement-in-snaps-even-the-classics-need-a-change","internal":false,"reflection":false,"clicks":0},{"url":"https://forum.snapcraft.io/t/classic-linter/32228","internal":true,"reflection":false,"title":"Classic linter","clicks":0},{"url":"https://forum.snapcraft.io/t/base-snaps/11198","internal":true,"reflection":false,"title":"Base snaps","clicks":0},{"url":"https://forum.snapcraft.io/t/snapcraft-linters/32211","internal":true,"reflection":false,"title":"Snapcraft linters","clicks":0},{"url":"https://forum.snapcraft.io/t/how-to-guides-for-classic-confinement/34416","internal":true,"reflection":true,"title":"How to guides for classic confinement","clicks":0},{"url":"https://forum.snapcraft.io/t/snap-documentation/11127","internal":true,"reflection":true,"title":"Snap documentation","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":true,"staff":true,"user_id":14015,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":true,"last_wiki_edit":"2023-03-22T10:26:26.629Z","can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":121710,"name":"Shengjing Zhu","username":"zhsj","avatar_template":"/user_avatar/forum.snapcraft.io/zhsj/{size}/9689_2.png","created_at":"2023-03-29T11:09:58.434Z","cooked":"\u003cp\u003eThe LDFLAGS example is only for x86_64. It should be some arch irreverent value. So it works for other architectures.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2023-03-29T11:09:58.434Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":5,"readers_count":4,"score":21.0,"yours":false,"topic_id":34099,"topic_slug":"set-up-classic-confinement-for-an-autotools-project","display_username":"Shengjing Zhu","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":14252,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":121712,"name":"David Boddie","username":"dboddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png","created_at":"2023-03-29T11:52:25.139Z","cooked":"\u003cp\u003eI agree. However, I’m not sure if there’s an easy way to locate the library directories for each architecture. Perhaps \u003ca href=\"/t/8349\"\u003eadvanced grammar\u003c/a\u003e could be used to select on architectures?\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2023-03-29T11:52:25.139Z","reply_count":0,"reply_to_post_number":2,"quote_count":0,"incoming_link_count":1,"reads":5,"readers_count":4,"score":6.0,"yours":false,"topic_id":34099,"topic_slug":"set-up-classic-confinement-for-an-autotools-project","display_username":"David Boddie","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/snapcraft-advanced-grammar/8349","internal":true,"reflection":false,"title":"Snapcraft advanced grammar","clicks":0}],"read":true,"user_title":null,"reply_to_user":{"username":"zhsj","avatar_template":"/user_avatar/forum.snapcraft.io/zhsj/{size}/9689_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":14015,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[120297,121710,121712]},"timeline_lookup":[[1,108],[2,79]],"suggested_topics":[{"id":30605,"title":"Build and Publish a ROS Snap with GitHub Actions","fancy_title":"Build and Publish a ROS Snap with GitHub Actions","slug":"build-and-publish-a-ros-snap-with-github-actions","posts_count":2,"reply_count":0,"highest_post_number":2,"image_url":null,"created_at":"2022-06-22T15:28:55.512Z","last_posted_at":"2022-06-22T15:43:40.132Z","bumped":true,"bumped_at":"2022-06-22T15:43:40.132Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":2,"views":1300,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":11989,"username":"gbeuzeboc","name":"","avatar_template":"/letter_avatar/gbeuzeboc/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}}]},{"id":31152,"title":"Refresh awareness","fancy_title":"Refresh awareness","slug":"refresh-awareness","posts_count":5,"reply_count":1,"highest_post_number":5,"image_url":null,"created_at":"2022-08-04T11:13:22.373Z","last_posted_at":"2023-02-16T16:37:34.392Z","bumped":true,"bumped_at":"2023-02-16T16:37:34.392Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":2,"views":1730,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":13385,"username":"ernstklrb","name":"","avatar_template":"/letter_avatar/ernstklrb/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1903,"username":"dhoomakethu","name":"dhoomkethu","avatar_template":"/letter_avatar/dhoomakethu/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":1418,"username":"galgalesh","name":"Merlijn Sebrechts","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png"}}]},{"id":31037,"title":"Snapcraft Tutorials","fancy_title":"Snapcraft Tutorials","slug":"snapcraft-tutorials","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-07-26T17:19:27.439Z","last_posted_at":"2022-07-26T17:19:27.549Z","bumped":true,"bumped_at":"2023-04-05T08:33:18.861Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":1214,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":33017,"title":"How Snapcraft builds snaps","fancy_title":"How Snapcraft builds snaps","slug":"how-snapcraft-builds-snaps","posts_count":6,"reply_count":2,"highest_post_number":6,"image_url":null,"created_at":"2022-12-09T16:57:58.963Z","last_posted_at":"2023-06-08T09:25:04.178Z","bumped":true,"bumped_at":"2023-06-08T09:25:04.178Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":3,"views":853,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":null,"description":"Original Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":11710,"username":"rpjday","name":"Robert P. J. Day","avatar_template":"/user_avatar/forum.snapcraft.io/rpjday/{size}/8457_2.png"}},{"extras":"latest","description":"Most Recent Poster","user":{"id":1755,"username":"lonroth","name":"Erik Lönroth","avatar_template":"/user_avatar/forum.snapcraft.io/lonroth/{size}/4894_2.png"}}]},{"id":35421,"title":"Hardware IO interfaces","fancy_title":"Hardware IO interfaces","slug":"hardware-io-interfaces","posts_count":3,"reply_count":1,"highest_post_number":3,"image_url":null,"created_at":"2023-05-31T16:22:56.882Z","last_posted_at":"2023-06-09T11:51:37.609Z","bumped":true,"bumped_at":"2023-06-09T11:51:37.609Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":121,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}},{"extras":null,"description":"Frequent Poster","user":{"id":13,"username":"pedronis","name":"Samuele Pedroni","avatar_template":"/user_avatar/forum.snapcraft.io/pedronis/{size}/46_2.png"}}]}],"tags":["how-to"],"id":34099,"title":"Set up classic confinement for an autotools project","fancy_title":"Set up classic confinement for an autotools project","posts_count":3,"created_at":"2023-02-27T17:10:47.688Z","views":807,"reply_count":1,"like_count":2,"last_posted_at":"2023-03-29T11:52:25.139Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"set-up-classic-confinement-for-an-autotools-project","category_id":15,"word_count":604,"deleted_at":null,"user_id":14015,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_34099","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":3,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"topic_timer":null,"message_bus_last_id":0,"participant_count":2,"show_read_indicator":false,"thumbnails":null,"details":{"notification_level":1,"participants":[{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png","post_count":2,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":14252,"username":"zhsj","name":"Shengjing Zhu","avatar_template":"/user_avatar/forum.snapcraft.io/zhsj/{size}/9689_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null}],"created_by":{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png"},"last_poster":{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png"},"links":[{"url":"https://github.com/snapcraft-doc-samples-unofficial/autotools-classic-example","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":1,"user_id":14015,"domain":"github.com","root_domain":"github.com"}]}}