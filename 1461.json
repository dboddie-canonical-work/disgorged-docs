{"post_stream":{"posts":[{"id":6766,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-07-27T15:41:00.612Z","cooked":"\u003cp\u003eThe previous (obsolete) discussion on the topic is \u003ca href=\"https://forum.snapcraft.io/t/snappy-and-users-and-groups/331\"\u003ehere\u003c/a\u003e. To make the discussion clearer I was asked to start a new topic with the currently agreed to design so that we may work through any additional details. As such, I will copy the entire ‘Introduction’ and a description of the 4 use cases from the other topic, but leave the ‘Implementation Ideas’ in the other topic for historical reference.\u003c/p\u003e\n\u003ch1\u003eIntroduction\u003c/h1\u003e\n\u003cp\u003eToday, snappy’s notion of users (and groups) is primitive:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edaemons run as root\u003c/li\u003e\n\u003cli\u003ecommands run as the user invoking the command\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor an initial implementation this has worked very well. The (untrusted) snaps run under root-strong confinement and the access to various resources is mediated via security policy.\u003c/p\u003e\n\u003cp\u003eThere are quite a few important use cases that are not covered by the current implementation however:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eadding system users/groups \u003ca href=\"https://launchpad.net/bugs/1606510\"\u003ehttps://launchpad.net/bugs/1606510\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003esupporting device access via ACLs for granting access of devices to (non-root) users. \u003ca href=\"https://launchpad.net/bugs/1646144\"\u003ehttps://launchpad.net/bugs/1646144\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eper-snap opt-in users to support things such as privilege dropping/separation within snaps. \u003ca href=\"https://launchpad.net/bugs/1619888\"\u003ehttps://launchpad.net/bugs/1619888\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eSupporting uids/gids in chroot environment\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e‘1’ and ‘2’ deal with users accessing resources that have been granted to the snap via the snap’s interface security policy and highlight the fact that while the snap may have access to a resource, that doesn’t necessarily mean that the user of the snap should have access to that resource.\u003c/p\u003e\n\u003cp\u003e‘3’ and ‘4’ deal with supporting a wider range of existing software.\u003c/p\u003e\n\u003cp\u003eThis is a complicated topic and while all 4 cases don’t necessarily need to be implemented at the same time, they all should be considered when designing how users and groups are supposed to work in a snappy world. This topic is intended to help people assigned to implementing any or all of these cases to have the necessary design.\u003c/p\u003e\n\u003cp\u003eLet’s first consider each use case in a little more detail.\u003c/p\u003e\n\u003ch1\u003eSystem user and groups\u003c/h1\u003e\n\u003cp\u003eExisting software often uses the concept of users and groups as a security mechanism to grant access to some application resource via traditional users and groups. Examples include lxd, docker and libvirt which all create UNIX sockets with 0660 permissions with ownership of \u003ccode\u003eroot:\u0026lt;some group\u0026gt;\u003c/code\u003e. They all do this because the socket provides privileged access to the host system that should only be granted to trusted users. In order for a non-root user to be able to use these services, the user must be added to the system group for the service.\u003c/p\u003e\n\u003cp\u003eToday, users that want to use snaps that use this security mechanism must either:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ealways run the command under sudo (eg, \u003ccode\u003esudo -H lxc ...\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eafter snap installation, perform additional steps to create the system group manually, then add users to that group (eg, \u003ccode\u003esudo addgroup lxd \u0026amp;\u0026amp; sudo adduser foo lxd\u003c/code\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003eDevice access\u003c/h1\u003e\n\u003cp\u003eFor many devices such as audio, UNIX group memberships are not used and instead ACLs are set on devices. Eg:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ getfacl /dev/snd/seq\n# file: dev/snd/seq\n# owner: root\n# group: audio\nuser::rw-\nuser:jamie:rw-\ngroup::rw-\nmask::rw-\nother::---\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e(note ‘user:jamie:rw-’ in the above).\u003c/p\u003e\n\u003cp\u003eIn the distant past, all these devices were chmod 0660 with a group specific to that device (eg, ‘audio’) or a catchall group like ‘plugdev’. While some historic groups are still found on the system (eg, ‘audio’), adding users to these groups or creating new groups and using \u003ccode\u003echgrp\u003c/code\u003e on the devices should be discouraged on modern systems. In the not so distant past (before systemd), device access is controlled via ACLs that were handled by consolekit via ‘udev-acl’. With systemd, this is handled by ‘uaccess’ via /lib/udev/rules.d/70-uaccess.rules, 71-seat.rules and 73-seat-late.rules where the “uaccess” builtin is used to set ACLs (and some historic groups for compatibility). Since the ‘acl’ package has been seeded in Core for some time (it wasn’t at first), anything that matches Core’s uaccess rules will just work today (eg, /dev/video*).\u003c/p\u003e\n\u003cp\u003eUnfortunately there are quite a few devices that are not covered either because there isn’t a uaccess rule for it (eg, a serial-port) or because the rules don’t apply for some reason (logging in via ssh and accessing /dev/video* or /dev/snd/* (seat rules don’t apply cause not local)).\u003c/p\u003e\n\u003ch1\u003eOpt-in per-snap users/groups\u003c/h1\u003e\n\u003cp\u003eA lot of existing applications are designed with the notion of privilege separation and/or permanently dropping privileges to secure their code. For example, postgresql, mysql, apache, nginx, etc. Some want to start as root to bind to a port and immediately permanently drop privileges and others want to fork processes under another user to (for example) handle untrusted input.\u003c/p\u003e\n\u003cp\u003eToday, all these daemon applications must run as root and are not allowed to drop privileges. While the security policy will keep the system safe and will keep the applications isolated, the security stance of the applications themselves is lessened because their security mechanisms can’t be used under snappy (eg, consider an application that handles untrusted input that would normally run a process under a separate user-- under snappy it is the same user so if there is a bug in processing the untrusted input, that process is able to attack the main application).\u003c/p\u003e\n\u003cp\u003eSoon (now that snap-confine is re-exec’d and seccomp arg filtering work can recommence) we’ll allow snaps to use the ‘daemon’ system user/group to drop privileges. While a shared user/group, this is no worse than the shared ‘root’ user/group and will allow applications to leverage their security mechanisms for up to one group.\u003c/p\u003e\n\u003cp\u003eSnappy should allow applications to use multiple users and groups. For example, it would be desirable for a complex snap that uses the LAMP stack to be able to let apache drop to a different user than mysql is dropping to so that successful attacks against the apache process don’t give access to mysql’s resources.\u003c/p\u003e\n\u003ch1\u003eChroot environments\u003c/h1\u003e\n\u003cp\u003eSometimes it is useful to take an existing chroot setup, put it into a snap and then have the snap chroot into the directory. There are several issues with this because processes running inside the chroot will use the chroot’s /etc/passwd, /etc/group, etc. If an application within the chroot tries to privilege drop or start as a user in the chroot’s /etc/passwd, it may not map in expected ways (eg, the security policy might allow dropping to the ‘daemon’ uid on the host, but ‘daemon’ in the chroot is a different uid so it is blocked).\u003c/p\u003e\n\u003ch1\u003eClassic distro vs Core\u003c/h1\u003e\n\u003cp\u003eAn important consideration when designing users and groups for snappy is that:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eClassic distro systems have writable passwd/group/shadow/etc databases\u003c/li\u003e\n\u003cli\u003eCore systems have read-only passwd/group/shadow/etc databases and writable ‘extrauser’ databases via libnss-extrausers\u003c/li\u003e\n\u003cli\u003eClassic distro systems don’t usually have libnss-extrausers installed\u003c/li\u003e\n\u003cli\u003eextrausers cannot be used to add users to system groups (ie, it may only be used to add users in the extrausers db to groups in the extrausers db)\u003c/li\u003e\n\u003c/ul\u003e","post_number":1,"post_type":1,"updated_at":"2017-08-15T14:08:11.272Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":8078,"reads":316,"readers_count":315,"score":40415.2,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":3,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://launchpad.net/bugs/1606510","internal":false,"reflection":false,"title":"Bug #1606510 “Mechanism to create system groups” : Bugs : Snappy","clicks":195},{"url":"https://launchpad.net/bugs/1646144","internal":false,"reflection":false,"title":"Bug #1646144 “ACLs to devices need to be supported in core \" : Bugs : Snappy","clicks":52},{"url":"https://launchpad.net/bugs/1619888","internal":false,"reflection":false,"title":"Bug #1619888 “please support per-snap users (eg, for dropping pr...” : Bugs : Snappy","clicks":48},{"url":"https://forum.snapcraft.io/t/snappy-and-users-and-groups-obsolete/331","internal":true,"reflection":false,"title":"Snappy and users and groups (obsolete)","clicks":0},{"url":"https://forum.snapcraft.io/t/chown-to-current-user/2831/2","internal":true,"reflection":true,"title":"Chown to current user","clicks":17},{"url":"https://forum.snapcraft.io/t/run-snapcraft-in-container-as-a-user/1438/19","internal":true,"reflection":true,"title":"Run snapcraft in container as a user","clicks":14},{"url":"https://forum.snapcraft.io/t/cannot-open-dev-ttys4/1623/13","internal":true,"reflection":true,"title":"Cannot open /dev/ttyS4","clicks":6},{"url":"https://forum.snapcraft.io/t/system-usernames/13386","internal":true,"reflection":true,"title":"System usernames","clicks":2},{"url":"https://forum.snapcraft.io/t/qt-qml-on-ubuntu-core/1688/38","internal":true,"reflection":true,"title":"Qt/QML on Ubuntu Core","clicks":2},{"url":"https://forum.snapcraft.io/t/raspberry-pi-gpio-as-a-user/3188/2","internal":true,"reflection":true,"title":"Raspberry Pi: GPIO as a user","clicks":1},{"url":"https://forum.snapcraft.io/t/providing-a-per-snap-shared-data-directory/3870/7","internal":true,"reflection":true,"title":"Providing a per-snap shared data directory","clicks":0},{"url":"https://forum.snapcraft.io/t/add-a-user-to-dialout-group/4125/9","internal":true,"reflection":true,"title":"Add a user to dialout group","clicks":0},{"url":"https://forum.snapcraft.io/t/strict-mode-seccomp-policy-violations-now-set-errno-to-eperm-instead-of-killing-the-process/4397/3","internal":true,"reflection":true,"title":"Strict mode seccomp policy violations now set errno to EPERM instead of killing the process","clicks":0},{"url":"https://forum.snapcraft.io/t/call-for-testing-openprintings-printing-stack-snap-printing-in-a-snap/4406","internal":true,"reflection":true,"title":"Call for testing: OpenPrinting's printing-stack-snap (Printing in a Snap)","clicks":0},{"url":"https://forum.snapcraft.io/t/creating-a-udev-rule-and-adding-a-user-to-the-dialout-group/5097/2","internal":true,"reflection":true,"title":"Creating a udev rule and adding a user to the dialout group","clicks":0},{"url":"https://forum.snapcraft.io/t/udev-rules-for-fastboot-and-adb/5443/5","internal":true,"reflection":true,"title":"Udev-rules for fastboot and adb","clicks":0},{"url":"https://forum.snapcraft.io/t/hdmi-output-with-ffplay/5858/13","internal":true,"reflection":true,"title":"HDMI Output with ffplay","clicks":0},{"url":"https://forum.snapcraft.io/t/listening-on-privileged-ports-is-root-the-only-option/6362/2","internal":true,"reflection":true,"title":"Listening on privileged ports -- is root the only option?","clicks":0},{"url":"https://forum.snapcraft.io/t/create-group-when-install-package/6794/3","internal":true,"reflection":true,"title":"Create group when install package","clicks":0},{"url":"https://forum.snapcraft.io/t/snapping-a-rails-app/7179/3","internal":true,"reflection":true,"title":"Snapping a Rails app","clicks":0},{"url":"https://forum.snapcraft.io/t/running-the-apps-inside-the-snap-under-non-privileged-user/7227/2","internal":true,"reflection":true,"title":"Running the apps inside the snap under non-privileged user","clicks":0},{"url":"https://forum.snapcraft.io/t/questions-about-the-plex-snap/7966/4","internal":true,"reflection":true,"title":"Questions about the Plex snap","clicks":0},{"url":"https://forum.snapcraft.io/t/phase-1-of-opt-in-per-snap-users-groups-aka-the-daemon-user/10624","internal":true,"reflection":true,"title":"Phase 1 of 'Opt-in per-snap users/groups' (aka, the 'daemon' user)","clicks":0},{"url":"https://forum.snapcraft.io/t/request-for-classic-confinement-tegh/10221/14","internal":true,"reflection":true,"title":"Request for classic confinement: Tegh","clicks":0},{"url":"https://forum.snapcraft.io/t/request-for-classic-confinement-tegh/10221/19","internal":true,"reflection":true,"title":"Request for classic confinement: Tegh","clicks":0},{"url":"https://forum.snapcraft.io/t/sharing-a-unix-domain-socket-between-a-daemon-and-an-app/12332/2","internal":true,"reflection":true,"title":"Sharing a Unix Domain Socket between a daemon and an app","clicks":0},{"url":"https://forum.snapcraft.io/t/how-to-grant-the-snap-app-access-to-the-dev-mem/7285/8","internal":true,"reflection":true,"title":"How to grant the snap app access to the /dev/mem?","clicks":0},{"url":"https://forum.snapcraft.io/t/snapping-cups-printing-stack-avahi-support-system-users-groups/1502/2","internal":true,"reflection":true,"title":"Snapping CUPS Printing Stack: Avahi support, system users/groups","clicks":0},{"url":"https://forum.snapcraft.io/t/user-authentication-in-snapd-pam-mediation/2915/7","internal":true,"reflection":true,"title":"User authentication in snapd (pam mediation)","clicks":0},{"url":"https://forum.snapcraft.io/t/developer-sprint-sep-17th-2018/7336/46","internal":true,"reflection":true,"title":"Developer sprint Sep 17th, 2018","clicks":0},{"url":"https://forum.snapcraft.io/t/feature-request-reinst-postinst-functionality-user-account-addition/8376","internal":true,"reflection":true,"title":"Feature request(reinst + postinst functionality; user account addition)","clicks":0},{"url":"https://forum.snapcraft.io/t/libusb-application-cant-access-device-even-after-the-raw-usb-interface-is-connected/23069/12","internal":true,"reflection":true,"title":"Libusb application can't access device even after the raw-usb interface is connected","clicks":0},{"url":"https://forum.snapcraft.io/t/the-snapd-roadmap/1973","internal":true,"reflection":true,"title":"The snapd roadmap","clicks":0},{"url":"https://forum.snapcraft.io/t/snapped-daemon-running-as-root-cannot-create-file-in-directory-with-odd-ownerships-permissions/17742/9","internal":true,"reflection":true,"title":"Snapped daemon running as root cannot create file in directory with odd ownerships/permissions","clicks":0},{"url":"https://forum.snapcraft.io/t/best-way-to-access-dev-uinput/16242/5","internal":true,"reflection":true,"title":"Best way to access /dev/uinput?","clicks":0},{"url":"https://forum.snapcraft.io/t/group-owner-of-multipass-socket-on-core-18/15899/6","internal":true,"reflection":true,"title":"Group owner of Multipass socket on core{18}","clicks":0},{"url":"https://forum.snapcraft.io/t/group-owner-of-multipass-socket-on-core-18/15899/2","internal":true,"reflection":true,"title":"Group owner of Multipass socket on core{18}","clicks":0},{"url":"https://forum.snapcraft.io/t/snapping-cups-printing-stack-avahi-support-system-users-groups/1502/4","internal":true,"reflection":true,"title":"Snapping CUPS Printing Stack: Avahi support, system users/groups","clicks":0},{"url":"https://forum.snapcraft.io/t/device-connection-via-usb-to-ubuntu-core/1780/5","internal":true,"reflection":true,"title":"Device connection via USB to Ubuntu-core","clicks":0},{"url":"https://forum.snapcraft.io/t/socket-activation-support/2050/3","internal":true,"reflection":true,"title":"Socket activation support","clicks":0},{"url":"https://forum.snapcraft.io/t/socket-activation-support/2050/4","internal":true,"reflection":true,"title":"Socket activation support","clicks":0},{"url":"https://forum.snapcraft.io/t/seccomp-filtering-for-setgroups/2109/2","internal":true,"reflection":true,"title":"Seccomp filtering for setgroups","clicks":0},{"url":"https://forum.snapcraft.io/t/expose-a-more-consistent-subset-of-systemds-service-directives/2268/24","internal":true,"reflection":true,"title":"Expose a more consistent subset of systemd's service directives","clicks":0},{"url":"https://forum.snapcraft.io/t/xdg-desktop-portal-proof-of-concept-demo/1027/5","internal":true,"reflection":true,"title":"Xdg-desktop-portal proof of concept demo","clicks":0},{"url":"https://forum.snapcraft.io/t/snapping-cups-printing-stack-avahi-support-system-users-groups/1502/24","internal":true,"reflection":true,"title":"Snapping CUPS Printing Stack: Avahi support, system users/groups","clicks":0},{"url":"https://forum.snapcraft.io/t/nba-go-nodejs-snap-failing-to-build/2732/17","internal":true,"reflection":true,"title":"Nba-go (nodejs) snap failing to build","clicks":0},{"url":"https://forum.snapcraft.io/t/snapping-cups-printing-stack-avahi-support-system-users-groups/1502/87","internal":true,"reflection":true,"title":"Snapping CUPS Printing Stack: Avahi support, system users/groups","clicks":0},{"url":"https://forum.snapcraft.io/t/call-for-testing-inadyn-dynamic-dns-client/1513/7","internal":true,"reflection":true,"title":"Call for Testing: Inadyn Dynamic DNS Client","clicks":0},{"url":"https://forum.snapcraft.io/t/is-snap-the-right-technology-for-a-server-application/3118/2","internal":true,"reflection":true,"title":"Is snap the right technology for a server application?","clicks":0},{"url":"https://forum.snapcraft.io/t/is-snap-the-right-technology-for-a-server-application/3118/8","internal":true,"reflection":true,"title":"Is snap the right technology for a server application?","clicks":0},{"url":"https://forum.snapcraft.io/t/layouts-re-mapping-snap-directories/1471/56","internal":true,"reflection":true,"title":"Layouts: re-mapping snap directories","clicks":0},{"url":"https://forum.snapcraft.io/t/providing-a-per-snap-shared-data-directory/3870/6","internal":true,"reflection":true,"title":"Providing a per-snap shared data directory","clicks":0}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[{"id":2,"count":4}],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":6767,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-07-27T15:45:39.166Z","cooked":"\u003ch2\u003eDiscarded ideas\u003c/h2\u003e\n\u003ch3\u003eDynamically created uid/gids on the device\u003c/h3\u003e\n\u003cp\u003e‘Global namespace’ in \u003ca href=\"https://forum.snapcraft.io/t/snappy-and-users-and-groups/331\" class=\"inline-onebox\"\u003eSnappy and users and groups (obsolete)\u003c/a\u003e discusses how to use uid/gids in the global namespace by dynamically creating them during snap install, with store processes and snapd governing their use. While we do want to use the global namespace for uid/gids, dynamically creating them complicates use of the uid/gids in the squashfs since the uid/gid isn’t predictable.\u003c/p\u003e\n\u003ch3\u003eUser namespaces\u003c/h3\u003e\n\u003cp\u003e‘User namespaces’ in \u003ca href=\"https://forum.snapcraft.io/t/snappy-and-users-and-groups/331\" class=\"inline-onebox\"\u003eSnappy and users and groups (obsolete)\u003c/a\u003e discusses the inherent problems and limitations with utilizing user namespaces for this feature so it doesn’t have to be repeated here.\u003c/p\u003e","post_number":2,"post_type":1,"updated_at":"2017-07-27T15:45:39.166Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":33,"reads":249,"readers_count":248,"score":214.8,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/snappy-and-users-and-groups-obsolete/331","internal":true,"reflection":false,"title":"Snappy and users and groups (obsolete)","clicks":0},{"url":"https://forum.snapcraft.io/t/phase-1-of-opt-in-per-snap-users-groups-aka-the-daemon-user/10624/18","internal":true,"reflection":true,"title":"Phase 1 of 'Opt-in per-snap users/groups' (aka, the 'daemon' user)","clicks":1}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":6782,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-07-27T19:15:06.277Z","cooked":"\u003ch1\u003eDesign\u003c/h1\u003e\n\u003cp\u003eUPDATE 2019-04-11: also refer to \u003ca href=\"https://forum.snapcraft.io/t/phase-1-of-opt-in-per-snap-users-groups-aka-the-daemon-user/10624/15\"\u003eshared-users, system-users and private-users\u003c/a\u003e\u003cbr\u003e\nUPDATE 2019-09-13: update to reflect outcomes\u003c/p\u003e\n\u003cp\u003eThis design has been discussed with Gustavo, the snapd team and the security team. Details remain and will be discussed in this topic.\u003c/p\u003e\n\u003ch3\u003eOverall design\u003c/h3\u003e\n\u003cp\u003esnapd will work in conjunction with the snap store to use a ‘global user/ID database’. This database will provide a predictable 1 to 1 mapping of numeric ID to name. When a snap is installed using one of these users/IDs, snapd will consult the global database and create a group with a name that matches the global name (prefixed with \u003ccode\u003esnap_\u003c/code\u003e) and gid that matches the global user/ID. It then creates a user with a name that matches the global name (prefixed with \u003ccode\u003esnap_\u003c/code\u003e) and uid that matches the global user/ID with the primary group set to the global name. In this manner, snaps may specify these usernames/groups in their yaml and use the uid/gid in the squashfs such that the uid/gids will resolve properly via getpwnam(), getpwuid(), getgrnam(), getgrgid(), etc both inside and outside the snap.\u003c/p\u003e\n\u003cp\u003eTo avoid clashes with existing uids and gids, snapd will use high numbered users/IDs in the 32-bit range. Historically, early on 15-bit uids were supported and later the more common 16-bit uids. \u003ca href=\"https://www.kernel.org/doc/Documentation/highuid.txt\"\u003eLinux\u003c/a\u003e and modern Unix systems now all support 32-bit uids with all but the most specialized filesystems (eg, cramfs) also supporting 32-bit uids by default (eg, ext2 and ext4 supports the non-default nouid32 option for interoperability with older (ancient) kernels). Notably, squashfs is confirmed to support 32-bit uids and gids.\u003c/p\u003e\n\u003cp\u003eTo use, a snap optionally declares the username/groups it wants to use in the snap.yaml. Eg:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ename: foo\napps:\n  ...\nsystem-usernames:\n  snap_foo: shared\n  snap_bar:\n    scope: shared\n  baz: external        # not implemented\n  snap_norf: private   # not implemented, 'snap_' requirement TBD\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe store will issue a snap declaration assertion allowing the use of the name.\u003c/p\u003e\n\u003cp\u003eUpon installation, snapd will verify the snap declaration to see if the snap should be able to use the user/ID. If not, ignore. Otherwise snapd will first create the group (\u003ccode\u003e--extrausers\u003c/code\u003e is used on Core only):\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo groupadd [--extrausers] \\\n    --system \\\n    --gid \u0026lt;group/ID from global db\u0026gt; \\\n    snap_\u0026lt;name from global db\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ethen create the user with that group:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo useradd [--extrausers] \\\n    --system \\\n    --home-dir /nonexistent --no-create-home \\\n    --shell /bin/false \\\n    --gid \u0026lt;user/ID from global db\u0026gt; --no-user-group \\\n    --uid \u0026lt;user/ID from global db\u0026gt; \\\n    snap_\u0026lt;name from global db\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ethen snapd will generate security policy that allows use of this username and group.\u003c/p\u003e\n\u003cp\u003eAt this point there are predictable uids/gids on the system that can safely be used by the squashfs, however if the snap does \u003ccode\u003egetent passwd foo\u003c/code\u003e it won’t be found because \u003ccode\u003esnap_foo\u003c/code\u003e was created. snapd should create a mapping such that inside the snap, the user doesn’t need \u003ccode\u003esnap_\u003c/code\u003e to be prefixed, but outside it does. While the implementation details are not finalized yet, in the core/base snap, ship a glibc NSS module and add it to /etc/nsswitch.conf (will need to bind mount this on classic). This module will appropriately map the getpwnam(), getpwuid(), etc calls correctly for the snap’s processes.\u003c/p\u003e\n\u003cp\u003eLocally unasserted snap installs won’t have a snap declaration assertion telling snapd what users/IDs to create/use. For these, snapd will consult the store’s ‘global user/ID database’ and grant the use. If the username doesn’t exist in the ‘global user/ID database’, the snapd will use a private user/ID range and will assign the username/group from this pool, locally (TBD).\u003c/p\u003e\n\u003ch3\u003eUse case 1: System user and groups\u003c/h3\u003e\n\u003cp\u003eThis case is mostly handled by specifying ‘external’ scoping for the username. External scoping means that the username/group does not use the \u003ccode\u003esnap_\u003c/code\u003e prefix. The snap declares what it wants to use and it can then chown, setuid, etc to the requested user/group. Eg, the lxd snap might have:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ename: lxd\nsystem-usernames:\n- lxd: external\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhich will create the \u003ccode\u003elxd\u003c/code\u003e user. Administrators then must use \u003ccode\u003esudo adduser \u0026lt;user\u0026gt; lxd\u003c/code\u003e to grant access to the lxd socket to the \u003ccode\u003e\u0026lt;user\u0026gt;\u003c/code\u003e. Importantly, external scoping is not implemented at this time because snapd cannot yet guarantee a predictable uid/gid is available for snapd (eg, \u003ccode\u003elxd\u003c/code\u003e may already be on the system) and therefore cannot be depended upon for use case 4 (chroot), below. External scoping may be implemented at a feature date. In the meantime, projects may request that snapd provide a shared-scope username (eg, \u003ccode\u003esnap_lxd\u003c/code\u003e) and adjust their documentation accordingly.\u003c/p\u003e\n\u003ch3\u003eUse case 2: Device access\u003c/h3\u003e\n\u003cp\u003eFor things not covered by udev and systemd automatically via shipped configuration, we can use setfacl to tag devices via udev rules. Eg, today serial devices are root:dialout 0660 and have no udev ACLs on them. Moving forward, we want a new backend that would be used by interfaces like the serial-port interface to specify that all serial-ports can be accessed via a particular group (eg, \u003ccode\u003esnap_serial-port\u003c/code\u003e) and the backend would add a udev rule to setfacl the serial-port devices (or use the uaccess mechanism) to ‘snap_serial-port’ such that \u003ccode\u003esudo adduser \u0026lt;user\u0026gt; snap_serial-port\u003c/code\u003e would grant access to the serial ports for that user.\u003c/p\u003e\n\u003cp\u003eTo be compatible with use case 4, this use case requires the group be maintained in the global user/ID database like this with ‘shared’ scoping (see below). Eg, have \u003ccode\u003esnap_serial-port\u003c/code\u003e in the global user/ID database which a new interface backend will use to have snapd create the user when the interface is connected.\u003c/p\u003e\n\u003cp\u003eAn example workaround based on the above that might inform the implementation \u003ca href=\"https://forum.snapcraft.io/t/hdmi-output-with-ffplay/5858/13\"\u003eis documented\u003c/a\u003e.\u003c/p\u003e\n\u003ch3\u003eUse case 3: Opt-in per-snap users/groups\u003c/h3\u003e\n\u003cp\u003eThis case is completely handled when using ‘shared’ scoping which is when different snaps request to use the same username. It will use a username with the \u003ccode\u003esnap_\u003c/code\u003e prefix. Eg:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esystem-usernames:\n  snap_foo: shared\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCurrently unimplemented, a future improvement will use ‘private’ scoping which allows a single snap to specify a username unique to the snap. Eg:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esystem-usernames:\n  XXX: private\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt is likely that \u003ccode\u003esnap_\u003c/code\u003e will be prefixed, but otherwise this needs design. To support squashfs files using predictable uids/gids, then this probably needs to be maintained in a private global user/ID list (to not expose private or brand snaps).\u003c/p\u003e\n\u003ch3\u003eUse case 4: Chroot environments\u003c/h3\u003e\n\u003cp\u003eThis case is completely handled by the current design. The snap declares what it wants to use and the squashfs can reliably have files with uids/gids matching the requested global users/IDs.\u003c/p\u003e\n\u003ch3\u003eOpen questions\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eWhile not discussed above, consider exposing usernames/groups from the host in the snap’s runtime (eg, the NSS module prefixes \u003ccode\u003eclassic_\u003c/code\u003e to uids on the host). Consider how to handle exact overlaps (should \u003ccode\u003eclassic_\u003c/code\u003e be prepended or not?), uids/gids that have different usernames/group names between the host and snap and usernames/group names that have different uids/gids between the host and snap\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eComponents to modify\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003esnapd\u003c/li\u003e\n\u003cli\u003euser backend for creating users/groups\u003c/li\u003e\n\u003cli\u003ebackend for setfacl/uaccess\u003c/li\u003e\n\u003cli\u003esnap declaration verification\u003c/li\u003e\n\u003cli\u003esupport private user/ID ranges\u003c/li\u003e\n\u003cli\u003eseccomp updates to allow using the uids/gids\u003c/li\u003e\n\u003cli\u003estore\u003c/li\u003e\n\u003cli\u003eeasily view and update the global user/ID database (preseeded with archive grep of users and groups created in debs via adduser/addgroup/useradd/groupadd)\u003c/li\u003e\n\u003cli\u003eeasily update snap declarations\u003c/li\u003e\n\u003cli\u003epass global user/ID database to the review tools\u003c/li\u003e\n\u003cli\u003ereview tools\u003c/li\u003e\n\u003cli\u003ewarn if using uid/gid without snap decl (ie, standard human review, like with classic confinement)\u003c/li\u003e\n\u003cli\u003edon’t complain if not -all-root anymore, but do complain if uids, gids are not in the declared list\u003c/li\u003e\n\u003cli\u003ecomplain if use users/IDs from the private user/ID range\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003ePhase 1\u003c/h3\u003e\n\u003cp\u003eAs an initial first phase, a single shared scope user will be created, \u003ccode\u003esnap_daemon\u003c/code\u003e, whose uid/gid is hardcoded in snapd (ie no store integration) that any snap is free to use without a snap declaration. Eg:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esystem-usernames:\n  snap_daemon: shared\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis will allow a snap to setuid, setguid, chown, etc to for privilege dropping and file ownership. The uid/gid will be consistent for all snaps and thus accommodate use case 2 and 4 immediately.\u003c/p\u003e","post_number":3,"post_type":1,"updated_at":"2019-09-13T21:28:05.546Z","reply_count":2,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":112,"reads":233,"readers_count":232,"score":663.6,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":6,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/phase-1-of-opt-in-per-snap-users-groups-aka-the-daemon-user/10624/15","internal":true,"reflection":false,"title":"Phase 1 of 'Opt-in per-snap users/groups' (aka, the 'daemon' user)","clicks":46},{"url":"https://www.kernel.org/doc/Documentation/highuid.txt","internal":false,"reflection":false,"clicks":2},{"url":"https://forum.snapcraft.io/t/hdmi-output-with-ffplay/5858/13","internal":true,"reflection":true,"title":"HDMI Output with ffplay","clicks":9}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":6784,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-07-27T19:20:15.047Z","cooked":"\u003cp\u003e\u003ca class=\"mention\" href=\"/u/niemeyer\"\u003e@niemeyer\u003c/a\u003e, \u003ca class=\"mention\" href=\"/u/mvo\"\u003e@mvo\u003c/a\u003e, \u003ca class=\"mention\" href=\"/u/zyga-snapd\"\u003e@zyga-snapd\u003c/a\u003e, \u003ca class=\"mention\" href=\"/u/tyhicks\"\u003e@tyhicks\u003c/a\u003e - please review this topic to see if I accurately captured the sprint agreements. There are also a number of open questions we should discuss.\u003c/p\u003e","post_number":4,"post_type":1,"updated_at":"2017-07-27T19:20:15.047Z","reply_count":1,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":1,"reads":172,"readers_count":171,"score":44.4,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":6986,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-07-31T12:56:17.079Z","cooked":"\u003caside class=\"quote no-group quote-modified\" data-username=\"jdstrand\" data-post=\"3\" data-topic=\"1461\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/jdstrand/40/6376_2.png\" class=\"avatar\"\u003e jdstrand:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWhat is the starting uid/gid number of the range. Perhaps 2147483648 (ie, 2^31)?\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eFYI when deciding on an ID range: \u003ca href=\"https://bugs.launchpad.net/ubuntu/+source/util-linux/+bug/1707645\"\u003ehttps://bugs.launchpad.net/ubuntu/+source/util-linux/+bug/1707645\u003c/a\u003e. It seems that while they are supported, there may be some corner cases (like lastlog) where software is written to efficiently account for them.\u003c/p\u003e","post_number":5,"post_type":1,"updated_at":"2017-07-31T12:56:17.079Z","reply_count":0,"reply_to_post_number":4,"quote_count":1,"incoming_link_count":1,"reads":171,"readers_count":170,"score":39.2,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://bugs.launchpad.net/ubuntu/+source/util-linux/+bug/1707645","internal":false,"reflection":false,"title":"Bug #1707645 “system with high numbered uids has huge sparse /va...” : Bugs : util-linux package : Ubuntu","clicks":5}],"read":true,"user_title":"","reply_to_user":{"username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":7315,"name":"Gustavo Niemeyer","username":"niemeyer","avatar_template":"/user_avatar/forum.snapcraft.io/niemeyer/{size}/4620_2.png","created_at":"2017-08-06T12:42:45.229Z","cooked":"\u003cp\u003e\u003ca class=\"mention\" href=\"/u/jdstrand\"\u003e@jdstrand\u003c/a\u003e Thanks for putting this together!  It does capture what we discussed well.\u003c/p\u003e\n\u003cp\u003eI’ll follow up with proposals for some of those questions soon.\u003c/p\u003e","post_number":6,"post_type":1,"updated_at":"2017-08-06T12:42:45.229Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":161,"readers_count":160,"score":32.2,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Gustavo Niemeyer","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":true,"staff":true,"user_id":1,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":7317,"name":"Neal Gompa","username":"Conan_Kudo","avatar_template":"/user_avatar/forum.snapcraft.io/conan_kudo/{size}/4463_2.png","created_at":"2017-08-06T13:22:11.563Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"jdstrand\" data-post=\"1\" data-topic=\"1461\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/jdstrand/40/6376_2.png\" class=\"avatar\"\u003e jdstrand:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003eClassic distro systems don’t usually have libnss-extrausers installed\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eI don’t even have this module in Fedora in the repositories, much less enabled as a source in nsswitch.conf. A quick lookup indicates this was a module built several years ago by someone in Debian and it lives pretty much exclusively in Debian/Ubuntu archive. The only external source we have supported out of the box is the \u003ccode\u003esss\u003c/code\u003e NSS module (which, because it’s SSSD, does actually support multiple backends and such, but there’s nothing we have that can interface with it right now).\u003c/p\u003e","post_number":7,"post_type":1,"updated_at":"2017-08-06T13:22:11.563Z","reply_count":1,"reply_to_post_number":null,"quote_count":1,"incoming_link_count":2,"reads":166,"readers_count":165,"score":48.2,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Neal Gompa","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"Fedora","title_is_group":false,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":7,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":7363,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-08-07T13:15:14.759Z","cooked":"\u003cp\u003eThat is useful information. Thankfully, the extrausers module is only required in the core snap for Ubuntu Core (ie, not cross-distro). As such, it can live in the core snap and base snaps (eg, ‘Fedora base’) don’t have to worry about it. Only if someone wanted to create an alternate core snap based on a different distribution would extrausers (or an alternative) need to be considered. It would even be possible for that alternate core to skip the need entirely and make the passwd and group database read/write.\u003c/p\u003e","post_number":8,"post_type":1,"updated_at":"2017-08-07T13:15:14.759Z","reply_count":2,"reply_to_post_number":7,"quote_count":0,"incoming_link_count":1,"reads":159,"readers_count":158,"score":46.8,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"Conan_Kudo","avatar_template":"/user_avatar/forum.snapcraft.io/conan_kudo/{size}/4463_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":7366,"name":"Oliver Grawert","username":"ogra","avatar_template":"/user_avatar/forum.snapcraft.io/ogra/{size}/22_2.png","created_at":"2017-08-07T13:19:30.841Z","cooked":"\u003caside class=\"quote no-group\" data-username=\"jdstrand\" data-post=\"8\" data-topic=\"1461\"\u003e\n\u003cdiv class=\"title\"\u003e\n\u003cdiv class=\"quote-controls\"\u003e\u003c/div\u003e\n\u003cimg alt=\"\" width=\"20\" height=\"20\" src=\"https://forum.snapcraft.io/user_avatar/forum.snapcraft.io/jdstrand/40/6376_2.png\" class=\"avatar\"\u003e jdstrand:\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003emake the passwd and group database read/write.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/aside\u003e\n\u003cp\u003eOnly when making all of core read write \u003cimg src=\"https://forum.snapcraft.io/images/emoji/emoji_one/wink.png?v=9\" title=\":wink:\" class=\"emoji\" alt=\":wink:\"\u003e else UID/GID filesystem mappings will eventually fall apart …\u003c/p\u003e","post_number":9,"post_type":1,"updated_at":"2017-08-07T13:19:30.841Z","reply_count":1,"reply_to_post_number":8,"quote_count":1,"incoming_link_count":5,"reads":159,"readers_count":158,"score":61.8,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Oliver Grawert","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":9,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":7367,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-08-07T13:21:47.301Z","cooked":"\u003cp\u003eMy point was that would ultimately be a decision for whoever was putting together ‘Alt Core’ devices, not that it would be a recommended thing to do.\u003c/p\u003e","post_number":10,"post_type":1,"updated_at":"2017-08-07T13:21:47.301Z","reply_count":0,"reply_to_post_number":9,"quote_count":0,"incoming_link_count":3,"reads":152,"readers_count":151,"score":60.4,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":"","reply_to_user":{"username":"ogra","avatar_template":"/user_avatar/forum.snapcraft.io/ogra/{size}/22_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8386,"name":"Marcelo Rezende Módolo","username":"modolo","avatar_template":"/user_avatar/forum.snapcraft.io/modolo/{size}/4583_2.png","created_at":"2017-08-18T22:03:05.987Z","cooked":"\u003cp\u003eHi,\u003c/p\u003e\n\u003cp\u003eI have a very strange behavior with my machine that is in AD (\u003cstrong\u003eSSSD\u003c/strong\u003e). For example, you can not list the files using hello-world.sh.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003emodolo@gsat019046:~$ snap run hello-world.sh\nLaunching a shell inside the default app confinement. Navigate to your\napp-specific directories with:\n\n  $ cd $SNAP\n  $ cd $SNAP_DATA\n  $ cd $SNAP_USER_DATA\n\nbash-4.3$ ls\nls: cannot open directory '.': Permission denied\nbash-4.3$ id\nuid=265601806 gid=265600513 groups=265600513,4(adm),7(lp),24(cdrom),27(sudo),30(dip),44(video),46(plugdev),113(lpadmin),128(sambashare),131(lxd),137(kvm),138(libvirtd),997(rkt),265602411,265602421,265604408,265604415,265609914,265613528,265614005,265619450,265619467,265619643,265619720,265619721,265626944,265626955,265629586,265630854,265632970,265632975,265632993,265633732,265633737,265636639,265636643,265636657,265636659,265636673,265637680,265638362,265639476,265639496,265641502,265641854,265641855,265643223,265643255,265643431,265645967,265646099,265646372,265646461,265646560,265646775,265646882,265647071,265651567,265651622,265653636,265653673,265653733,265653757,265653855,265654408,265654550,265654552,265654561,265654890,265656369,265656370,265656371,265656375,265656378,265656379,265656380,265656382,265656384,265656386,265656388,265656390,265657145,265658322,265659423,265659533,265659589,265660036,265660834,265661748,265662107,265662110,265662117,265662118,265662131,265662136,265662139,265662143,265662145,265662543,265662739,265662740,265664437,265664505,265664999,265665490,265665669,265665758,265665833,265665886,265665887,265666570,265666594,265666614,265666618,265666619,265666620,265666621\nbash-4.3$ \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI have verified that it is not possible to consult domain users!\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ebash-4.3$ getent passwd modolo\nbash-4.3$ getent passwd root  \nroot:x:0:0:root:/root:/bin/bash\u003c/code\u003e\u003c/pre\u003e","post_number":11,"post_type":1,"updated_at":"2017-08-18T22:03:05.987Z","reply_count":1,"reply_to_post_number":8,"quote_count":0,"incoming_link_count":2,"reads":150,"readers_count":149,"score":45.0,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Marcelo Rezende Módolo","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1027,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8390,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-08-19T01:08:24.530Z","cooked":"\u003cp\u003eToday, domain users need the ‘network’ interface and the hello-world snap does not ‘plugs: [ network ]’.\u003c/p\u003e\n\u003cp\u003eTo make this work in the default template (arguably something that should be done), fine-grained network mediation in AppArmor (future work) might be able to allow name lookups. Alternatively, an nss module could be made available to snaps (eg, a bind mount) that could talk to an out of process proxy on the system to do the lookups on behalf of the application.\u003c/p\u003e","post_number":12,"post_type":1,"updated_at":"2017-08-19T01:08:24.530Z","reply_count":2,"reply_to_post_number":11,"quote_count":0,"incoming_link_count":2,"reads":146,"readers_count":145,"score":49.2,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/call-for-testing-libreoffice-5-4-2/2626/13","internal":true,"reflection":true,"title":"Call for testing: libreoffice 5.4.2","clicks":0}],"read":true,"user_title":"","reply_to_user":{"username":"modolo","avatar_template":"/user_avatar/forum.snapcraft.io/modolo/{size}/4583_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8391,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-08-19T01:24:38.317Z","cooked":"\u003cp\u003eWe could also do something similar to what I \u003ca href=\"https://forum.snapcraft.io/t/snaps-and-nfs-home/438/9\"\u003eproposed for NFS /home\u003c/a\u003e: make a core config that unconditionally allows the network interface/apparmor nameservice abstraction. I wonder how useful this (and NFS /home) would be per-snap rather than global config…\u003c/p\u003e","post_number":13,"post_type":1,"updated_at":"2017-08-19T01:24:38.317Z","reply_count":0,"reply_to_post_number":12,"quote_count":0,"incoming_link_count":8,"reads":147,"readers_count":146,"score":69.4,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/snaps-and-nfs-home/438/9","internal":true,"reflection":false,"title":"Snaps and NFS /home","clicks":8},{"url":"https://forum.snapcraft.io/t/snaps-and-nfs-home/438/13","internal":true,"reflection":true,"title":"Snaps and NFS /home","clicks":0}],"read":true,"user_title":"","reply_to_user":{"username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8426,"name":"Marcelo Rezende Módolo","username":"modolo","avatar_template":"/user_avatar/forum.snapcraft.io/modolo/{size}/4583_2.png","created_at":"2017-08-19T13:15:00.120Z","cooked":"\u003cp\u003eThe lack of possibility to list users of the domain prevents me for example from completing the installation of snap libreoffice!\u003c/p\u003e\n\u003cp\u003eOn the same machine if I authenticate myself as a local user, I can fire the libreoffice (\u003cstrong\u003esnap run libreoffice\u003c/strong\u003e) and complete the installation!\u003c/p\u003e\n\u003cp\u003eI believe the libroffice needs to check local folders (~ / .config) that are not available since the permissions become wrong.\u003c/p\u003e","post_number":14,"post_type":1,"updated_at":"2017-08-19T13:15:00.120Z","reply_count":0,"reply_to_post_number":12,"quote_count":0,"incoming_link_count":5,"reads":150,"readers_count":149,"score":55.0,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Marcelo Rezende Módolo","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/device-connection-via-usb-to-ubuntu-core/1780/11","internal":true,"reflection":true,"title":"Device connection via USB to Ubuntu-core","clicks":1},{"url":"https://forum.snapcraft.io/t/user-authentication-in-snapd-pam-mediation/2915/9","internal":true,"reflection":true,"title":"User authentication in snapd (pam mediation)","clicks":0}],"read":true,"user_title":null,"reply_to_user":{"username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":1027,"hidden":false,"trust_level":1,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8558,"name":"Jamie Strandboge","username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","created_at":"2017-08-21T12:59:03.235Z","cooked":"\u003cp\u003e\u003ca class=\"mention\" href=\"/u/niemeyer\"\u003e@niemeyer\u003c/a\u003e - I noticed the topic title changed to ‘multiple users and groups in snaps’. This title doesn’t cover all four use cases and is somewhat confusing. The use case are (taken from the introduction):\u003c/p\u003e\n\u003cp\u003e\"\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eadding system users/groups \u003ca href=\"https://launchpad.net/bugs/1606510\"\u003ehttps://launchpad.net/bugs/1606510\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003esupporting device access via ACLs for granting access of devices to (non-root) users. \u003ca href=\"https://launchpad.net/bugs/1646144\"\u003ehttps://launchpad.net/bugs/1646144\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eper-snap opt-in users to support things such as privilege dropping/separation within snaps. \u003ca href=\"https://launchpad.net/bugs/1619888\"\u003ehttps://launchpad.net/bugs/1619888\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eSupporting uids/gids in chroot environment\u003cbr\u003e\n\"\u003c/li\u003e\n\u003c/ol\u003e","post_number":15,"post_type":1,"updated_at":"2017-08-22T19:36:56.560Z","reply_count":2,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":13,"reads":146,"readers_count":145,"score":104.2,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Jamie Strandboge","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":2,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://launchpad.net/bugs/1606510","internal":false,"reflection":false,"title":"Bug #1606510 “Mechanism to create system groups” : Bugs : Snappy","clicks":20},{"url":"https://launchpad.net/bugs/1619888","internal":false,"reflection":false,"title":"Bug #1619888 “please support per-snap users (eg, for dropping pr...” : Bugs : Snappy","clicks":13},{"url":"https://launchpad.net/bugs/1646144","internal":false,"reflection":false,"title":"Bug #1646144 “ACLs to devices need to be supported in core \" : Bugs : Snappy","clicks":4}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":21,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":8633,"name":"Zygmunt Krynicki","username":"zyga-snapd","avatar_template":"/user_avatar/forum.snapcraft.io/zyga-snapd/{size}/14_2.png","created_at":"2017-08-22T08:45:04.425Z","cooked":"\u003cp\u003eThe bug links above are broken, the right links are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://bugs.launchpad.net/snappy/+bug/1606510\"\u003ehttps://bugs.launchpad.net/snappy/+bug/1606510\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bugs.launchpad.net/snappy/+bug/1646144\"\u003ehttps://bugs.launchpad.net/snappy/+bug/1646144\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://bugs.launchpad.net/snappy/+bug/1619888\"\u003ehttps://bugs.launchpad.net/snappy/+bug/1619888\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","post_number":16,"post_type":1,"updated_at":"2017-08-22T08:45:04.425Z","reply_count":0,"reply_to_post_number":15,"quote_count":0,"incoming_link_count":3,"reads":144,"readers_count":143,"score":43.8,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Zygmunt Krynicki","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://bugs.launchpad.net/snappy/+bug/1606510","internal":false,"reflection":false,"title":"Bug #1606510 “Mechanism to create system groups” : Bugs : Snappy","clicks":24},{"url":"https://bugs.launchpad.net/snappy/+bug/1619888","internal":false,"reflection":false,"title":"Bug #1619888 “please support per-snap users (eg, for dropping pr...” : Bugs : Snappy","clicks":23},{"url":"https://bugs.launchpad.net/snappy/+bug/1646144","internal":false,"reflection":false,"title":"Bug #1646144 “ACLs to devices need to be supported in core \" : Bugs : Snappy","clicks":19}],"read":true,"user_title":null,"reply_to_user":{"username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":2,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":18508,"name":"Simon Davy","username":"bloodearnest","avatar_template":"/user_avatar/forum.snapcraft.io/bloodearnest/{size}/4493_2.png","created_at":"2018-01-29T12:34:30.818Z","cooked":"\u003cp\u003eJust to add some user feedback to this point, the key thing missing here for us is use case 3.\u003c/p\u003e\n\u003cp\u003eVarious servers will just point blank refuse to run as uid 0, with an explicit check in the codebase. Examples include postgresql and squid, both exactly the kind of software you are likely to want to embed in a snap.\u003c/p\u003e\n\u003cp\u003eThe only option for us right now with postgresql is to src patch those checks out, and compile custom postgresql binaries to ship with our snap, something we are currently not willing to do (our build times would skyrocket, amongst other issues).\u003c/p\u003e\n\u003cp\u003eWe would be ok with running as one of the ~20 or so default users (daemon? www-data? nobody? proxy?) in this case, but no filtering on setuid makes this impossible for a strictly confined snap.\u003c/p\u003e","post_number":17,"post_type":1,"updated_at":"2018-01-29T12:34:30.818Z","reply_count":0,"reply_to_post_number":15,"quote_count":0,"incoming_link_count":1,"reads":133,"readers_count":132,"score":46.6,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Simon Davy","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/feature-request-reinst-postinst-functionality-user-account-addition/8376/15","internal":true,"reflection":true,"title":"Feature request(reinst + postinst functionality; user account addition)","clicks":0}],"read":true,"user_title":null,"reply_to_user":{"username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"bookmarked":false,"actions_summary":[{"id":2,"count":1}],"moderator":false,"admin":false,"staff":false,"user_id":612,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":28511,"name":"Dmitrii Shcherbakov","username":"dmitriis","avatar_template":"/letter_avatar/dmitriis/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png","created_at":"2018-06-20T20:13:51.024Z","cooked":"\u003cp\u003eAny progress or changes for this?\u003c/p\u003e","post_number":18,"post_type":1,"updated_at":"2018-06-20T20:13:51.024Z","reply_count":0,"reply_to_post_number":3,"quote_count":0,"incoming_link_count":0,"reads":127,"readers_count":126,"score":25.4,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Dmitrii Shcherbakov","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"reply_to_user":{"username":"jdstrand","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":60,"hidden":false,"trust_level":2,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":28812,"name":"Ian Johnson","username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png","created_at":"2018-06-26T11:34:51.866Z","cooked":"\u003cp\u003eHow does this design relate to an app like syncthing which needs per-user services that are run as individual users already on the system, and not as root? In this case we wouldn’t be able to  enumerate ahead of time in the snapcraft.yaml what users to run as, so I’m not sure if any of the 4 use cases presented would solve this problem. Perhaps this is entirely orthogonal to the design here…\u003c/p\u003e\n\u003cp\u003eNote that the associated launchpad bug for this particular use case is here : \u003ca href=\"https://bugs.launchpad.net/snappy/+bug/1613420\"\u003ehttps://bugs.launchpad.net/snappy/+bug/1613420\u003c/a\u003e\u003c/p\u003e","post_number":19,"post_type":1,"updated_at":"2018-06-26T11:34:51.866Z","reply_count":2,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":132,"readers_count":131,"score":36.4,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Ian Johnson","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://bugs.launchpad.net/snappy/+bug/1613420","internal":false,"reflection":false,"title":"Bug #1613420 “No way to run daemons on user session” : Bugs : Snappy","clicks":5}],"read":true,"user_title":"","bookmarked":false,"actions_summary":[],"moderator":true,"admin":false,"staff":true,"user_id":2438,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":28816,"name":"Oliver Grawert","username":"ogra","avatar_template":"/user_avatar/forum.snapcraft.io/ogra/{size}/22_2.png","created_at":"2018-06-26T11:39:48.744Z","cooked":"\u003cp\u003ein that usecase you would likely use a session systemd unit (which only works on newer systems where systemd manages the desktop session) … i think there was a topic somewhere in the forum about autostarting session related services (which would automatically run as the logged in user)\u003c/p\u003e\n\u003cp\u003ealternatively you could start it as dbus session service … that would run as the user as well …\u003c/p\u003e","post_number":20,"post_type":1,"updated_at":"2018-06-26T11:41:44.048Z","reply_count":0,"reply_to_post_number":19,"quote_count":0,"incoming_link_count":8,"reads":134,"readers_count":133,"score":66.8,"yours":false,"topic_id":1461,"topic_slug":"multiple-users-and-groups-in-snaps","display_username":"Oliver Grawert","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://forum.snapcraft.io/t/running-the-apps-inside-the-snap-under-non-privileged-user/7227/5","internal":true,"reflection":true,"title":"Running the apps inside the snap under non-privileged user","clicks":6}],"read":true,"user_title":null,"reply_to_user":{"username":"ijohnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png"},"bookmarked":false,"actions_summary":[],"moderator":false,"admin":false,"staff":false,"user_id":9,"hidden":false,"trust_level":3,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[6766,6767,6782,6784,6986,7315,7317,7363,7366,7367,8386,8390,8391,8426,8558,8633,18508,28511,28812,28816,28818,29013,61877,61884]},"timeline_lookup":[[1,2149],[5,2146],[6,2140],[8,2139],[11,2127],[15,2125],[16,2124],[17,1964],[18,1821],[19,1816],[22,1813],[23,1241]],"tags":[],"id":1461,"title":"Multiple users and groups in snaps","fancy_title":"Multiple users and groups in snaps","posts_count":24,"created_at":"2017-07-27T15:41:00.527Z","views":19115,"reply_count":13,"like_count":7,"last_posted_at":"2020-01-21T21:45:14.586Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"multiple-users-and-groups-in-snaps","category_id":5,"word_count":4139,"deleted_at":null,"user_id":21,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_1461","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":24,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"topic_timer":null,"message_bus_last_id":0,"participant_count":11,"show_read_indicator":false,"thumbnails":null,"details":{"notification_level":1,"participants":[{"id":21,"username":"jdstrand","name":"Jamie Strandboge","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png","post_count":11,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":9,"username":"ogra","name":"Oliver Grawert","avatar_template":"/user_avatar/forum.snapcraft.io/ogra/{size}/22_2.png","post_count":2,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":1027,"username":"modolo","name":"Marcelo Rezende Módolo","avatar_template":"/user_avatar/forum.snapcraft.io/modolo/{size}/4583_2.png","post_count":2,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":1,"username":"niemeyer","name":"Gustavo Niemeyer","avatar_template":"/user_avatar/forum.snapcraft.io/niemeyer/{size}/4620_2.png","post_count":2,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":612,"username":"bloodearnest","name":"Simon Davy","avatar_template":"/user_avatar/forum.snapcraft.io/bloodearnest/{size}/4493_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":644,"username":"till.kamppeter","name":"Till Kamppeter","avatar_template":"/user_avatar/forum.snapcraft.io/till.kamppeter/{size}/3687_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":1418,"username":"galgalesh","name":"Merlijn Sebrechts","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":2438,"username":"ijohnson","name":"Ian Johnson","avatar_template":"/user_avatar/forum.snapcraft.io/ijohnson/{size}/2091_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":2,"username":"zyga-snapd","name":"Zygmunt Krynicki","avatar_template":"/user_avatar/forum.snapcraft.io/zyga-snapd/{size}/14_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":7,"username":"Conan_Kudo","name":"Neal Gompa","avatar_template":"/user_avatar/forum.snapcraft.io/conan_kudo/{size}/4463_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null},{"id":60,"username":"dmitriis","name":"Dmitrii Shcherbakov","avatar_template":"/letter_avatar/dmitriis/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null}],"created_by":{"id":21,"username":"jdstrand","name":"Jamie Strandboge","avatar_template":"/user_avatar/forum.snapcraft.io/jdstrand/{size}/6376_2.png"},"last_poster":{"id":1418,"username":"galgalesh","name":"Merlijn Sebrechts","avatar_template":"/user_avatar/forum.snapcraft.io/galgalesh/{size}/9283_2.png"},"links":[{"url":"https://launchpad.net/bugs/1606510","title":"Bug #1606510 “Mechanism to create system groups” : Bugs : Snappy","internal":false,"attachment":false,"reflection":false,"clicks":215,"user_id":21,"domain":"launchpad.net","root_domain":"launchpad.net"},{"url":"https://forum.snapcraft.io/t/system-usernames/13386","title":"System usernames","internal":true,"attachment":false,"reflection":false,"clicks":123,"user_id":1418,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://launchpad.net/bugs/1619888","title":"Bug #1619888 “please support per-snap users (eg, for dropping pr...” : Bugs : Snappy","internal":false,"attachment":false,"reflection":false,"clicks":61,"user_id":21,"domain":"launchpad.net","root_domain":"launchpad.net"},{"url":"https://launchpad.net/bugs/1646144","title":"Bug #1646144 “ACLs to devices need to be supported in core \" : Bugs : Snappy","internal":false,"attachment":false,"reflection":false,"clicks":56,"user_id":21,"domain":"launchpad.net","root_domain":"launchpad.net"},{"url":"https://forum.snapcraft.io/t/phase-1-of-opt-in-per-snap-users-groups-aka-the-daemon-user/10624/15","title":"Phase 1 of 'Opt-in per-snap users/groups' (aka, the 'daemon' user)","internal":true,"attachment":false,"reflection":false,"clicks":46,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://bugs.launchpad.net/snappy/+bug/1606510","title":"Bug #1606510 “Mechanism to create system groups” : Bugs : Snappy","internal":false,"attachment":false,"reflection":false,"clicks":24,"user_id":2,"domain":"bugs.launchpad.net","root_domain":"launchpad.net"},{"url":"https://bugs.launchpad.net/snappy/+bug/1619888","title":"Bug #1619888 “please support per-snap users (eg, for dropping pr...” : Bugs : Snappy","internal":false,"attachment":false,"reflection":false,"clicks":23,"user_id":2,"domain":"bugs.launchpad.net","root_domain":"launchpad.net"},{"url":"https://bugs.launchpad.net/snappy/+bug/1646144","title":"Bug #1646144 “ACLs to devices need to be supported in core \" : Bugs : Snappy","internal":false,"attachment":false,"reflection":false,"clicks":19,"user_id":2,"domain":"bugs.launchpad.net","root_domain":"launchpad.net"},{"url":"https://forum.snapcraft.io/t/hdmi-output-with-ffplay/5858/13","title":"HDMI Output with ffplay","internal":true,"attachment":false,"reflection":false,"clicks":18,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/chown-to-current-user/2831/2","title":"Chown to current user","internal":true,"attachment":false,"reflection":true,"clicks":17,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/run-snapcraft-in-container-as-a-user/1438/19","title":"Run snapcraft in container as a user","internal":true,"attachment":false,"reflection":true,"clicks":14,"user_id":1,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/how-to-autostart-a-snap-of-a-desktop-application/2449","title":"How to autostart a snap of a desktop application?","internal":true,"attachment":false,"reflection":false,"clicks":10,"user_id":1,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/user-authentication-in-snapd-pam-mediation/2915","title":"User authentication in snapd (pam mediation)","internal":true,"attachment":false,"reflection":false,"clicks":9,"user_id":644,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/hdmi-output-with-ffplay/5858/13","title":"HDMI Output with ffplay","internal":true,"attachment":false,"reflection":true,"clicks":9,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/snaps-and-nfs-home/438/9","title":"Snaps and NFS /home","internal":true,"attachment":false,"reflection":false,"clicks":8,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/running-the-apps-inside-the-snap-under-non-privileged-user/7227/5","title":"Running the apps inside the snap under non-privileged user","internal":true,"attachment":false,"reflection":true,"clicks":6,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/cannot-open-dev-ttys4/1623/13","title":"Cannot open /dev/ttyS4","internal":true,"attachment":false,"reflection":true,"clicks":6,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://bugs.launchpad.net/snappy/+bug/1613420","title":"Bug #1613420 “No way to run daemons on user session” : Bugs : Snappy","internal":false,"attachment":false,"reflection":false,"clicks":5,"user_id":2438,"domain":"bugs.launchpad.net","root_domain":"launchpad.net"},{"url":"https://bugs.launchpad.net/ubuntu/+source/util-linux/+bug/1707645","title":"Bug #1707645 “system with high numbered uids has huge sparse /va...” : Bugs : util-linux package : Ubuntu","internal":false,"attachment":false,"reflection":false,"clicks":5,"user_id":21,"domain":"bugs.launchpad.net","root_domain":"launchpad.net"},{"url":"https://www.kernel.org/doc/Documentation/highuid.txt","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":2,"user_id":21,"domain":"www.kernel.org","root_domain":"kernel.org"},{"url":"https://forum.snapcraft.io/t/qt-qml-on-ubuntu-core/1688/38","title":"Qt/QML on Ubuntu Core","internal":true,"attachment":false,"reflection":true,"clicks":2,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/system-usernames/13386","title":"System usernames","internal":true,"attachment":false,"reflection":true,"clicks":2,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/raspberry-pi-gpio-as-a-user/3188/2","title":"Raspberry Pi: GPIO as a user","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/phase-1-of-opt-in-per-snap-users-groups-aka-the-daemon-user/10624/18","title":"Phase 1 of 'Opt-in per-snap users/groups' (aka, the 'daemon' user)","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":21,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://forum.snapcraft.io/t/device-connection-via-usb-to-ubuntu-core/1780/11","title":"Device connection via USB to Ubuntu-core","internal":true,"attachment":false,"reflection":true,"clicks":1,"user_id":2,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"}]}}