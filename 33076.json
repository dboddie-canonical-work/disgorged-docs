{"post_stream":{"posts":[{"id":117576,"name":"Graham Morrison","username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","created_at":"2022-12-13T12:33:36.830Z","cooked":"\u003cp\u003eWe will examine a complete snapcraft.yaml file for an application called \u003cem\u003ewethr\u003c/em\u003e, a command line weather tool.\u003c/p\u003e\n\u003cp\u003eBelow, we will look at blocks of code that were not previously covered in the \u003ca href=\"/t/basic-snapcraft-yaml-example/33074\"\u003eBasic snapcraft.yaml example\u003c/a\u003e,  or those that differ significantly from what we already discussed.\u003c/p\u003e\n\u003cp\u003eThe full snapcraft.yaml file is available on the \u003ca href=\"https://github.com/snapcrafters/wethr/blob/master/snap/snapcraft.yaml\"\u003eproject GitHub page\u003c/a\u003e. The contents may change and slightly differ from the example shown below.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003ename: wethr\nsummary: Command line weather tool.\ndescription: |\n  Get current weather\n\nadopt-info: wethr\nbase: core20\ngrade: stable\nconfinement: strict\n\narchitectures:\n  - build-on: amd64\n  - build-on: armhf\n  - build-on: arm64\n\napps:\n  wethr:\n    command: bin/wethr\n    plugs:\n      - network\n\nparts:\n  wethr:\n    plugin: npm\n    npm-node-version: \"10.14.1\"\n    source: https://github.com/twobucks/wethr.git\n    source-type: git\n    override-pull: |\n      snapcraftctl pull\n      last_committed_tag=\"$(git describe --tags --abbrev=0)\"\n      last_committed_tag_ver=\"$(echo ${last_committed_tag} | sed 's/v//')\"\n      last_released_tag=\"$(snap info wethr | awk '$1 == \"latest/beta:\" { print $2 }')\"\n      # If the latest tag from the upstream project has not been released to\n      # beta, build that tag instead of master.\n      if [ \"${last_committed_tag_ver}\" != \"${last_released_tag}\" ]; then\n        git fetch\n        git checkout \"${last_committed_tag}\"\n      fi\n      snapcraftctl set-version \"$(git describe --tags | sed 's/v//')\"\n    build-packages:\n      - git\n      - sed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe metadata, base, and confinement declarations are rather similar to our basic example, but with some notable differences:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe wethr snap does not explicitly declare the snap version. This is something that will be explained below.\u003c/li\u003e\n\u003cli\u003eThe wethr snap uses core20 as its base.\u003c/li\u003e\n\u003cli\u003eThe wethr snap uses strict confinement instead of devmode.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"heading--adopt\"\u003eadopt-info\u003c/h2\u003e\n\u003cp\u003eThis keyword instructs Snapcraft to “adopt” metadata information using \u003ca href=\"/t/using-external-metadata/4642\"\u003eexternal metadata\u003c/a\u003e sources. Such use can be useful for CI systems, where the declarations in the snapcraft.yaml file can be obtained from scripts rather than manually.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThere are multiple ways that information can be obtained.\u003c/li\u003e\n\u003cli\u003eMultiple metadata fields can be populated using this keyword.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn this example, the wethr snap application version is obtained from the Git repository release tag. This is done two stages:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eadopt-info keyword instructs Snapcraft to populate fields not explicitly specified.\u003c/li\u003e\n\u003cli\u003eIn the parts section at the end of the snapcraft.yaml file (which will be discussed below):\n\u003cul\u003e\n\u003cli\u003eA portion of the default snap lifecycle definition is manually \u003ca href=\"/t/override-build-steps/4892\"\u003eoverridden\u003c/a\u003e (override-pull).\u003c/li\u003e\n\u003cli\u003eA set of commands in the BASH shell syntax is used to derive the version string.\u003c/li\u003e\n\u003cli\u003eThe version string is set using the snapcraftctl scriptlet.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003eadopt-info: wethr\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAlternatively, in this particular example, the version field could also be manually defined, e.g.: version: ‘1.5’.\u003c/p\u003e\n\u003ch2 id=\"heading--grade\"\u003egrade\u003c/h2\u003e\n\u003cp\u003eThe optional grade keyword defines the quality level of the snap. Two levels are available: devel and stable. Snaps with the devel grade level cannot be uploaded to the stable channel in the Snap Store.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003egrade: stable\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"heading--architectures\"\u003eArchitectures\u003c/h2\u003e\n\u003cp\u003eThis section defines the target \u003ca href=\"/t/4972\"\u003earchitectures\u003c/a\u003e for which the snap should be built. It requires the build system that is running the Snapcraft tool to be able to compile and build the snap for the listed platforms.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003earchitectures:\n- build-on: amd64\n- build-on: armhf\n- build-on: arm64\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"heading--build\"\u003eBuild definition\u003c/h2\u003e\n\u003cp\u003eWhile largely similar to the yt-dlp example, the wethr application does introduce some notable differences in the build definition section. We will discuss the parts section first.\u003c/p\u003e\n\u003ch3 id=\"heading--parts\"\u003eThe parts definition\u003c/h3\u003e\n\u003cp\u003eThe parts definition consists of the following lines of code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003eparts:\n  wethr:\n    plugin: npm\n    npm-node-version: \"10.14.1\"\n    source: https://github.com/twobucks/wethr.git\n    source-type: git\n    override-pull: |\n      snapcraftctl pull\n      last_committed_tag=\"$(git describe --tags --abbrev=0)\"\n      last_committed_tag_ver=\"$(echo ${last_committed_tag} | sed 's/v//')\"\n      last_released_tag=\"$(snap info wethr | awk '$1 == \"latest/beta:\" { print $2 }')\"\n      # If the latest tag from the upstream project has not been released to\n      # beta, build that tag instead of master.\n      if [ \"${last_committed_tag_ver}\" != \"${last_released_tag}\" ]; then\n        git fetch\n        git checkout \"${last_committed_tag}\"\n      fi\n      snapcraftctl set-version \"$(git describe --tags | sed 's/v//')\"\n    build-packages:\n      - git\n      - sed\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe wethr snap also only has one part. However, here, it is built using the npm plugin, which is a Snapcraft plugin designed to simplify the building of Node.js and JavaScript-based applications.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eplugin\u003c/strong\u003e: This block defines the use of the Snapcraft \u003ca href=\"/t/the-npm-plugin/17591\"\u003enpm plugin\u003c/a\u003e that will perform various language-specific commands in the background. The npm plugin creates parts that use Node.js and/or the JavaScript package manager npm. The plugin declaration has several sub-sections:\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003enpm-node-version:\u003c/strong\u003e defines the specific version of Node to be used.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003esource\u003c/strong\u003e: defines the URL or a path of the application code that needs to be downloaded for the build. It can be a local or remote path, and can refer to a directory tree, a compressed archive or a revision control repository.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003esource-type\u003c/strong\u003e: defines the type of the online source. This allows the plugin to perform relevant source-specific actions to successfully complete the download of the necessary data for the part.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eoverride-pull\u003c/strong\u003e: opens a multi-line block inside which BASH-syntax commands are used to perform operations that cannot be satisfied by the default Snapcraft lifecycle pull operation. In the wethr example, the listed commands are used to derive the right version of the application, and set it using the snapcraftctl scriptlet.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003ebuild-packages\u003c/strong\u003e: defines the list of tools and libraries that are required to successfully build or compile the part. The build packages are obtained from the repository archives that match the snap base, and need to be written in the syntax that can be correctly interpreted by the apt package manager. For instance, a foo build package from the Ubuntu 20.04 archive would be installed (apt install foo) in the snap build environment during the build lifecycle. In this case, the snap needs the git tool to retrieve the sources from the Git repository (GitHub) and the sed tool to perform the string search and replace action on the commit tag.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"heading--apps\"\u003eThe apps definition\u003c/h3\u003e\n\u003cp\u003eThe apps build definition consists of the following lines of code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"lang-yaml\"\u003eapps:\n  wethr:\n    command: bin/wethr\n    plugs:\n      - network\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe wethr example has a single application - wethr. Other snaps may have multiple sub-applications or executables.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003ecommand\u003c/strong\u003e: defines the path to the executable (relative to the snap) and arguments to use when this application runs.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eplugs\u003c/strong\u003e: defines the list of interfaces to which the app will have access to. This enables the intended application functionality. In this specific case, the wethr snap will be allowed access to the network interface, which is not available by default under strict confinement, and thus be able to retrieve the weather information from online sources.\u003c/li\u003e\n\u003c/ul\u003e","post_number":1,"post_type":1,"updated_at":"2023-05-25T14:54:16.650Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":56,"reads":10,"readers_count":9,"score":266.8,"yours":false,"topic_id":33076,"topic_slug":"intermediate-snapcraft-yaml-example","display_username":"Graham Morrison","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":5,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"link_counts":[{"url":"https://github.com/snapcrafters/wethr/blob/master/snap/snapcraft.yaml","internal":false,"reflection":false,"clicks":3},{"url":"https://forum.snapcraft.io/t/basic-snapcraft-yaml-example/33074","internal":true,"reflection":false,"title":"Basic snapcraft.yaml example","clicks":3},{"url":"https://forum.snapcraft.io/t/the-npm-plugin/17591","internal":true,"reflection":false,"title":"The npm plugin","clicks":0},{"url":"https://forum.snapcraft.io/t/architectures/4972","internal":true,"reflection":false,"title":"Architectures","clicks":0},{"url":"https://forum.snapcraft.io/t/override-build-steps/4892","internal":true,"reflection":false,"title":"Override build steps","clicks":0},{"url":"https://forum.snapcraft.io/t/using-external-metadata/4642","internal":true,"reflection":false,"title":"Using external metadata","clicks":0},{"url":"https://forum.snapcraft.io/t/build-and-publishing-example/33078","internal":true,"reflection":true,"title":"Build and publishing example","clicks":0},{"url":"https://forum.snapcraft.io/t/snapcraft-quickstart/32983","internal":true,"reflection":true,"title":"Snapcraft quickstart","clicks":0},{"url":"https://forum.snapcraft.io/t/snap-documentation/11127","internal":true,"reflection":true,"title":"Snap documentation","clicks":0}],"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":true,"staff":true,"user_id":2772,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":"Fixed hard-coded link.","can_view_edit_history":true,"wiki":true,"last_wiki_edit":"2023-05-25T14:54:16.669Z","can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false},{"id":117719,"name":"Graham Morrison","username":"degville","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","created_at":"2022-12-15T10:46:41.984Z","cooked":"","post_number":2,"post_type":3,"updated_at":"2022-12-15T10:46:41.984Z","reply_count":0,"reply_to_post_number":null,"quote_count":0,"incoming_link_count":0,"reads":6,"readers_count":5,"score":1.2,"yours":false,"topic_id":33076,"topic_slug":"intermediate-snapcraft-yaml-example","display_username":"Graham Morrison","primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_bg_color":null,"primary_group_flair_color":null,"version":1,"can_edit":false,"can_delete":false,"can_recover":false,"can_wiki":false,"read":true,"user_title":null,"bookmarked":false,"actions_summary":[],"moderator":true,"admin":true,"staff":true,"user_id":2772,"hidden":false,"trust_level":4,"deleted_at":null,"user_deleted":false,"edit_reason":null,"can_view_edit_history":true,"wiki":false,"action_code":"visible.enabled","can_accept_answer":false,"can_unaccept_answer":false,"accepted_answer":false}],"stream":[117576,117719]},"timeline_lookup":[[1,185],[2,183]],"suggested_topics":[{"id":32983,"title":"Snapcraft quickstart","fancy_title":"Snapcraft quickstart","slug":"snapcraft-quickstart","posts_count":3,"reply_count":0,"highest_post_number":3,"image_url":null,"created_at":"2022-12-07T10:11:58.985Z","last_posted_at":"2022-12-15T10:43:36.422Z","bumped":true,"bumped_at":"2022-12-15T10:43:08.332Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":6,"views":915,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":35613,"title":"Revisions","fancy_title":"Revisions","slug":"revisions","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2023-06-14T12:00:32.246Z","last_posted_at":"2023-06-14T12:00:32.397Z","bumped":true,"bumped_at":"2023-06-15T11:10:36.858Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":45,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]},{"id":35563,"title":"The WebkitGTK Problem","fancy_title":"The WebkitGTK Problem","slug":"the-webkitgtk-problem","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2023-06-10T19:28:37.898Z","last_posted_at":"2023-06-10T19:28:38.095Z","bumped":true,"bumped_at":"2023-06-13T06:29:04.736Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":1,"views":55,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":13970,"username":"soumyaDghosh","name":"Soumyadeep Ghosh","avatar_template":"/letter_avatar/soumyadghosh/{size}/5_6d6f4cde2641c35611d5cac2fb97c77e.png"}}]},{"id":35643,"title":"Cross-compile an autotools project","fancy_title":"Cross-compile an autotools project","slug":"cross-compile-an-autotools-project","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2023-06-15T14:56:04.836Z","last_posted_at":"2023-06-15T14:56:05.012Z","bumped":true,"bumped_at":"2023-06-15T14:56:05.012Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":["how-to","autotools","cross-compile"],"like_count":0,"views":31,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":14015,"username":"dboddie","name":"David Boddie","avatar_template":"/user_avatar/forum.snapcraft.io/dboddie/{size}/9564_2.png"}}]},{"id":31668,"title":"The posix-mq interface","fancy_title":"The posix-mq interface","slug":"the-posix-mq-interface","posts_count":1,"reply_count":0,"highest_post_number":1,"image_url":null,"created_at":"2022-09-08T12:00:35.327Z","last_posted_at":"2022-09-08T12:00:35.467Z","bumped":true,"bumped_at":"2023-04-14T09:29:21.981Z","archetype":"regular","unseen":false,"pinned":false,"unpinned":null,"visible":true,"closed":false,"archived":false,"bookmarked":null,"liked":null,"tags":[],"like_count":0,"views":889,"category_id":15,"featured_link":null,"has_accepted_answer":false,"posters":[{"extras":"latest single","description":"Original Poster, Most Recent Poster","user":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"}}]}],"tags":[],"id":33076,"title":"Intermediate snapcraft.yaml example","fancy_title":"Intermediate snapcraft.yaml example","posts_count":2,"created_at":"2022-12-13T12:33:36.674Z","views":813,"reply_count":0,"like_count":0,"last_posted_at":"2022-12-15T10:46:41.984Z","visible":true,"closed":false,"archived":false,"has_summary":false,"archetype":"regular","slug":"intermediate-snapcraft-yaml-example","category_id":15,"word_count":1141,"deleted_at":null,"user_id":2772,"featured_link":null,"pinned_globally":false,"pinned_at":null,"pinned_until":null,"image_url":null,"slow_mode_seconds":0,"draft":null,"draft_key":"topic_33076","draft_sequence":null,"unpinned":null,"pinned":false,"current_post_number":1,"highest_post_number":2,"deleted_by":null,"actions_summary":[{"id":4,"count":0,"hidden":false,"can_act":false},{"id":8,"count":0,"hidden":false,"can_act":false},{"id":7,"count":0,"hidden":false,"can_act":false}],"chunk_size":20,"bookmarked":false,"topic_timer":null,"message_bus_last_id":0,"participant_count":1,"show_read_indicator":false,"thumbnails":null,"details":{"notification_level":1,"participants":[{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png","post_count":1,"primary_group_name":null,"primary_group_flair_url":null,"primary_group_flair_color":null,"primary_group_flair_bg_color":null}],"created_by":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"},"last_poster":{"id":2772,"username":"degville","name":"Graham Morrison","avatar_template":"/user_avatar/forum.snapcraft.io/degville/{size}/2021_2.png"},"links":[{"url":"https://forum.snapcraft.io/t/basic-snapcraft-yaml-example/33074","title":"Basic snapcraft.yaml example","internal":true,"attachment":false,"reflection":false,"clicks":3,"user_id":2772,"domain":"forum.snapcraft.io","root_domain":"snapcraft.io"},{"url":"https://github.com/snapcrafters/wethr/blob/master/snap/snapcraft.yaml","title":null,"internal":false,"attachment":false,"reflection":false,"clicks":3,"user_id":2772,"domain":"github.com","root_domain":"github.com"}]}}